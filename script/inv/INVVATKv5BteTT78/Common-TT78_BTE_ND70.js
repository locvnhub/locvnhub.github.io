console.log("js ext --- phiên bản ngày : 10:20 23/06/2025");
/* Common-TT78_BTE_ND70.js - 10:20 23/06/2025 */
function keypress(e){var t=null,t=window.event?window.event.keyCode:e.which;if((t<48||57<t)&&8!=t&&127!=t)return!1}function FormatNumberCurrency(e){"USD"==e&&($("#ExchangeRate").formatOnlyNumber(),$("#ConvertedAmount").InitialMoneyUSD()),$("table.products tbody input._number, table.fees tbody input._number").unbind("focusout"),$("table.products tbody input._number, table.fees tbody input._number").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnly().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$("table.list-bin-bottom tbody input._number").unbind("focusout"),$("table.list-bin-bottom tbody input._number").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnly().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$("table.products tbody input.number-negative").unbind("focusout"),$("table.products tbody input.number-negative").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnlyWithNegative().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$("table.list-bin-bottom tbody input.number-negative").unbind("focusout"),$("table.list-bin-bottom tbody input.number-negative").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnlyWithNegative().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$(".groupTotal").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnlyWithNegative().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$(".number-positive").each(function(e,t){fnInitialFormatNumber(this)}).ForceNumericOnlyWithPositive().focus(function(){var e=$(this).val();$(this).val(e.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)})}function SetDisplayAttachFile(e){var t=document.getElementById("DivFileUpload"),a=document.getElementsByClassName("divLyDo"),n=document.getElementById("IsCreateFileAdjust"),o=$("#SignNote"),i=$("#AjustNote"),r=$("#FirstAjustNote"),u=$("#LastAjustNote");if(1==e){document.getElementById("IsCreateFile_True").checked=!0,t.style.display="none";for(var l=0;l<a.length;l++)a[l]&&(a[l].style.display="block");n.checked=!0,(1<(type=parseFloat($("#type").val()||0)||0)?(i.addClass("required").attr("required","required"),r.addClass("required").attr("required","required"),u):o).addClass("required").attr("required","required")}else{document.getElementById("IsCreateFile_False").checked=!0,t.style.display="block";for(l=0;l<a.length;l++)a[l]&&(a[l].style.display="none");n.checked=!1,(1<(type=parseFloat($("#type").val()||0)||0)?(i.removeClass("required").removeAttr("required","required"),r.removeClass("required").removeAttr("required","required"),u):o).removeClass("required").removeAttr("required","required")}}function ProcessAttachment(){$("#_txtFile").off("click keypress"),$("#_txtFile").click(function(){$("#_fleAttackment").val(null),$("#_fleAttackment").trigger("click")}).keypress(function(e){if(13==e.keyCode||13==e.which)return $(this).trigger("click"),!1})}function ChangeAttachment(a,n,o,i){$("#_fleAttackment").change(function(){var e,t;0<this.files.length?(e=$(this)[0].files[0])&&(t=e.name.substring(e.name.lastIndexOf(".")+1),-1<["doc","docx","pdf","DOC","DOCX","PDF"].indexOf(t)?5242880<this.files[0].size?(bootbox.alert({buttons:{ok:{label:n}},title:a,message:o.Replace("{{file_Size}} ","5MB"),size:"small"}),$("#_txtFile").val("")):$("#fleAttackment").val(e.name):($(this).val(""),bootbox.alert({buttons:{ok:{label:n}},title:a,message:i,size:"small"}),$("#_txtFile").val(""))):(console.log("Không có file nào được chọn"),$("#_txtFile").val()),$("#_txtFile").blur()})}function setEventPage_common_ND70(){0<$("#CheckBoxHDDThu").length&&$("#CheckBoxHDDThu").on("click",function(){$("#CheckBoxHDDThu").is(":checked")?$("#DivHDDThu").show():($("#HDDThu").val("0").trigger("change"),$("#DivHDDThu").hide(),$(".products th.tb-HDDThu").hide(),$(".products td.tb-HDDThu").hide(),$("select.Issum").each(function(e,t){var a=$(t).val();$(t).html(`<option value="0" >Hàng hóa</option>
                <option value="1">Khuyến mại</option>
                <option value="2">Chiết khấu</option>
                <option value="4">Ghi chú</option>`),$(t).val(a)}))}),0<$("#HDDThu").length&&($("#HDDThu").on("change",function(){var e=$(this).val(),n=("5"==e&&$("#CheckBoxHDDThu").prop("checked",!0).trigger("click"),$(".products th.tb-HDDThu").hide(),$(".products td.tb-HDDThu").hide(),`<option value="0" >Hàng hóa</option>
                        <option value="1">Khuyến mại</option>
                        <option value="2">Chiết khấu</option>
                        <option value="4">Ghi chú</option>`),o=n+'<option value="5">Hàng hóa đặc trưng</option>';switch(e){case"0":$(".products th.tb-HDDThu").hide(),$(".products td.tb-HDDThu").hide(),$("select.Issum").each(function(e,t){var a=$(t).val();$(t).html(n),$(t).val(a)});break;case"1":$(".products th.HDDThu_1").show(),$(".products td.HDDThu_1").show(),$("select.Issum").each(function(e,t){var a=$(t).val();$(t).html(o),$(t).val(a)});break;case"2":$(".products th.HDDThu_2").show(),$(".products td.HDDThu_2").show(),$("select.Issum").each(function(e,t){var a=$(t).val();$(t).html(o),$(t).val(a)});break;case"3":$(".products th.HDDThu_3").show(),$(".products td.HDDThu_3").show(),$("select.Issum").each(function(e,t){var a=$(t).val();$(t).html(o),$(t).val(a)})}"undefined"!=typeof BteGlobal&&(BteGlobal.NEW_ROW_STR=getProductRowStr())}),$("#HDDThu").trigger("change")),0<$("#PaymentMethodDropdown").length&&$("#PaymentMethodDropdown").change(function(){var e=$(this).val(),e=(document.getElementById("divPaymentMethodOther").style.display="HTK"===e?"block":"none","HTK"!==e?e:"");$("#PaymentMethod").val(e)}),""==$("#PaymentMethod").val()&&0<$("#PaymentMethodDropdown").length&&("HTK"==$("#PaymentMethodDropdown").val()?$("#PaymentMethodDropdown"):$("#PaymentMethod").val($("#PaymentMethodDropdown").val())).trigger("change"),0<$("#CheckBoxTCHDon").length&&$("#CheckBoxTCHDon").change(onCheckBoxTCHDonChange)}function SetFeeDataSource(){var l;0!=$("table.fees tbody tr").length&&$("table.fees").length&&(l=[],$("table.fees tbody tr").each(function(e,t){var a,n={},o=$(t),i=$(t).find("input[type=text].fee-name"),r=$(t).find("input[type=text].fee-amount"),u=$(t).find("input[type=text].fee-vatrate"),t=$(t).find("input[type=text].fee-vatamount");n.Id=o.attr("id")||"",n.NameTax=i.attr("name")||"",n.ExtraAmount=r.attr("name")||"",n.ExtraVatRate=u.attr("name")||"",n.ExtraVatAmount=t.attr("name")||"",r.val()&&(n.NameValue=i.val()||"",n.ExtraAmountValue=r.val()||0,n.ExtraVatRateValue=u.val()||0,n.ExtraVatAmountValue=t.val()||0,0!=n.ExtraAmountValue&&(a=n.ExtraAmountValue.FormatNumUK(),n.ExtraAmountValue=a.toString().replace(",",".")),0!=n.ExtraVatRateValue&&(a=n.ExtraVatRateValue.FormatNumUK(),n.ExtraVatRateValue=a.toString().replace(",",".")),0!=n.ExtraVatAmountValue&&(a=n.ExtraVatAmountValue.FormatNumUK(),n.ExtraVatAmountValue=a.toString().replace(",",".")),l.push(n))}),$("#feeDataSource").val(JSON.stringify(l)))}function onAmountFeeChange(){var e=($("#Total").val()||"0").FormatNumUK(),t=($("#VATAmount").val()||"0").FormatNumUK(),a=0,n=0,t=($("#DiscountOther").length&&(a=($("#DiscountOther").val()||"0").FormatNumUK()),$("#AmountFee").length&&(n=($("#AmountFee").val()||"0").FormatNumUK()),Math.abs(e)+Math.abs(t)-Math.abs(a)+Math.abs(n)),a=(e<0&&(t*=-1),$("#Pattern").val().split("/")[0]);0<$("#GiamThueGTGT").length&&"2"==a&&$("#GiamThueGTGT").is(":checked")&&(n=parseFloat($("#SoTienGiamThue").val().FormatNumUK()||0)||0,0!=(n=RoundCurrency(n)))&&(t-=n),$("#Amount").val(t.format(0,3,typeCurrency)).trigger("focusout"),$("#Amount").trigger("change")}function onTableFeeChange(){var e=$("#CurrencyUnit").val()||"VND",n=0;$("table.fees tbody tr").each((e,t)=>{var a=($(t).find("input.fee-amount").val()||"0").FormatNumUK(),t=($(t).find("input.fee-vatamount").val()||"0").FormatNumUK();n+=a+t}),$("#AmountFee").val(n.format(0,3,e)),$("#AmountFee").trigger("change")}function setEventTablePhi(){var a;0!=$("table.fees tbody tr").length&&($("table.fees tbody td.delr").on("click",function(){var e=$(this).parent("tr").eq(0);$(e).find("input.fee-amount").val(0),$(e).find("input.fee-vatrate").val(0),$(e).find("input.fee-vatamount").val(0),$(e).find("input.fee-amount").val(0).trigger("change")}),$("#AmountFee").on("change",function(){$("#Total").trigger("change")}),a=$("#CurrencyUnit").val()||"VND",$("table.fees tbody .fee-amount , table.fees tbody .fee-vatrate").change(function(){var e=$(this).parents("tr").eq(0),t=($(e).find("input.fee-amount").val()||"0").FormatNumUK()*($(e).find("input.fee-vatrate").val()||"0").FormatNumUK()/100;$(e).find("input.fee-vatamount").val(t.format(0,3,a)),$(e).find("input.fee-vatamount").trigger("change"),onTableFeeChange()}))}function printScrAdJust(){submit("printScrAdJust"),$.ajax({type:"POST",url:"/Share/ajxPreviewAdjust",data:$("form:first").serialize(),success:function(e){var t=document.getElementById("container");t.innerHTML=e,$(t).printArea({mode:"iframe",popWd:1e3,popHt:700,popClose:!1,tagPrint:"#container"})}})}function onCheckBoxTCHDonChange(e){"object"==typeof BteGlobal&&(BteGlobal.isChiecKhauThuongMai=$(this).is(":checked")),0<$("#AmountFee").length&&$(this).is(":checked")&&(t=($("#AmountFee").val()||"0").FormatNumUK(),$("#AmountFee").val((-1*Math.abs(t)).format(0,3,typeCurrency)));var t=$("#DivTCHDon"),a=$("#SBKE"),n=$("#dtNBKE"),o=$("#NBKE"),i=(type=parseFloat($("#type").val()||0)||0,invType=$("#Pattern").val().split("/")[0],$(this).is(":checked"));i?($("#TCHDon").val("5"),t.show(),a.addClass("required").attr("required","required"),n.addClass("required").attr("required"),o.addClass("required").attr("required","required"),a.attr("disabled",!1),n.attr("disabled",!1),o.attr("disabled",!1),"1"!=invType&&"2"!=invType||0!=type||($("table.products tbody input.number-negative").each(function(){var e=parseFloat($(this).val().FormatNumUK()||0)||0;e<0&&(e=Math.abs(e),$(this).val(e.format(0,3,typeCurrency))),$(this).removeClass("number-negative").addClass("_number")}),$("table.fees").length&&$("table.fees tbody input.number-negative").each(function(){var e=parseFloat($(this).val().FormatNumUK()||0)||0;e<0&&(e=Math.abs(e),$(this).val(e.format(0,3,typeCurrency))),$(this).removeClass("number-negative").addClass("_number")}))):($("#TCHDon").val("0"),t.hide(),a.removeClass("required").removeAttr("required"),n.removeClass("required").removeAttr("required"),o.removeClass("required").removeAttr("required"),a.val(""),n.val(""),o.val("01/01/1957"),("1"==invType||"2"==invType&&0==type)&&($("table.products tbody input._number").each(function(){$(this).removeClass("_number").addClass("number-negative")}),$("table.fees").length)&&$("table.fees tbody input.number-negative").each(function(){$(this).removeClass("number-negative").addClass("_number")})),$("table.products tbody .Issum").each(function(){i&&"2"===$(this).val()&&$(this).val("0"),$(this).find('option[value="2"]').prop("disabled",i)}),$("table.products tbody .quantity").trigger("change"),$("table.fees").length&&$("table.fees tbody .fee-amount").trigger("change")}jQuery.fn.ForceNumericOnlyWithNegative=function(){return this.each(function(){$(this).blur(function(){"NaN"==$(this).val()&&$(this).val(0)}),$(this).keypress(function(e){var t=$(this).attr("class"),a=null;if(window.event){if(a=window.event.keyCode,-1<t.indexOf("number")||-1<t.indexOf("quantity"))return!(a<48&&46!=a&&44!=a&&45!=a||45==a&&0<this.selectionStart||45==a&&-1<e.target.value.indexOf("-")||57<a&&189!=a)&&checkDotComma(e.target.value,a)}else{if(8===(a=e.which))return;if(-1<t.indexOf("number")||-1<t.indexOf("quantity"))return!(a<48&&46!=a&&44!=a&&45!=a||45==a&&0<this.selectionStart||45==a&&-1<e.target.value.indexOf("-")||57<a&&189!=a)&&checkDotComma(e.target.value,a)}})})},$(document).ready(function(){setEventPage_common_ND70(),setEventTablePhi()}),$("#dtNBKE").change(function(){var e=$(this).val()||"01/01/1957";$("#NBKE").val(e)});
