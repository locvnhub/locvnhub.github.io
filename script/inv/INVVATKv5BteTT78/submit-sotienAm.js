/*
2025 01 - 24
fix luu so tien am ChiecKhau

</script>
<script src="https://cdn.jsdelivr.net/gh/locvnhub/locvnhub.github.io@main/script/inv/INVVATKv5BteTT78/submit-sotienAm.js">
</script>
<script>

*/
this.submit=function(){if(!checkMstCusName())return!1;var a=localStorage.getItem("VNPT_localization");submit_over_begin();var t=0;$("#VatAmount0").val("0"),$("#VatAmount5").val("0"),$("#VatAmount10").val("0"),$("#GrossValue").val("0"),$("#GrossValue0").val("0"),$("#GrossValue5").val("0"),$("#GrossValue10").val("0"),$("#GrossValueNonTax").val("0"),$("#VATAMOUNTOTHER").val("0"),$("#GROSSVALUEOTHER").val("0"),$("#VatAmount8").val("0"),$("#GrossValue8").val("0");var e=$("#Total").val().FormatNumUK(),l=$("#VATAmount").val().FormatNumUK(),n=$("#VATRateItem").val().toFloat(),r=$("#VATRateF").val();if(-99==n&&""!=r&&[0,5,8,10,-1,-2].indexOf(r=r.FormatNumUK())>-1&&($("#VATRateItem").val(r),$("#VATRateF").val(""),n=r),BteGlobal.IS_INV_NO_VAT&&(n=-4),n>0)10==n?($("#VatAmount10").val(l.toString().replaceAll(".",",")),$("#GrossValue10").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n)):5==n?($("#VatAmount5").val(l.toString().replaceAll(".",",")),$("#GrossValue5").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n)):8==n&&($("#VatAmount8").val(l.toString().replaceAll(".",",")),$("#GrossValue8").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n));else if(-99==n){var o=$("#VATRateF").val();(""==$("#VATRateF").val()||null==$("#VATRateF").val())&&(o=-3,$("#VATRateF").val(o),$("table.products .VATRate").val(o)),n=parseFloat(o||"0"),$("#VATAMOUNTOTHER").val(l.toString().replaceAll(".",",")),$("#GROSSVALUEOTHER").val(e.toString().replaceAll(".",",")),$("#VATRate").val($("#VATRateF").val())}else -1==n?($("#GrossValue").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n)):0==n?($("#VatAmount0").val("0"),$("#GrossValue0").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n)):-2==n&&($("#GrossValueNonTax").val(e.toString().replaceAll(".",",")),$("#VATRate").val(n));if($("#errorTaxCode").length>0){$("#errorTaxCode").show(),$("#CusTaxCode").addClass("error");var i="Xin lỗi, m\xe3 số thuế của kh\xe1ch h\xe0ng kh\xf4ng chuẩn.\n- Bạn c\xf3 muốn tiếp tục lưu h\xf3a đơn kh\xf4ng?";if("en"===a&&(i="Sorry, The Customer's Tax Code Is Not Correct. \n- Do You Want To Continue To Save The Invoice?"),!confirm(i))return!1}if($("#Total").val().FormatNumUK()>=2e7&&"CK"!=$("#PaymentMethod").val()){var u="Số tiền qu\xe1 lớn, bạn n\xean thanh to\xe1n chuyển khoản.\n- Bạn c\xf3 muốn tiếp tục lưu h\xf3a đơn kh\xf4ng?";if("en"===a&&(u="The Amount Is Too Large, You Should Pay For The Transfer. \n- Do You Want To Continue To Save The Invoice?"),!confirm(u))return!1}var s=$("#INV_TYPE").val(),v=$("#Amount").val().FormatNumUK(),h=$("#OldAmount").val();if("3"==s&&h>0&&v>=(h=h.FormatNumUK())){var u="Bạn đang lập h\xf3a đơn điều chỉnh giảm qu\xe1 100% chi tiết h\xe0ng h\xf3a trong h\xf3a đơn gốc.\n- Bạn c\xf3 muốn tiếp tục lưu h\xf3a đơn kh\xf4ng?";if(!confirm(u))return!1}"3"==$("#INV_TYPE").val()&&["VatAmount0","VatAmount5","VatAmount10","GrossValue","GrossValue0","GrossValue5","GrossValue10","GrossValueNonTax","VATAMOUNTOTHER","GROSSVALUEOTHER","VatAmount8","GrossValue8"].forEach(function(a){var t=$("#"+a).val();t&&t.FormatNumUK()>0&&$("#"+a).val("-"+t)});var A=0,c=[],T=getListProductString();if(c=T.productList,t=T.check,A=($("#DiscountAmount").val()||"0").FormatNumUK(),0==c.length){if(0==t){var m="Xin lỗi, danh s\xe1ch sản phẩm chưa c\xf3 hoặc th\xf4ng tin sản phẩm bị thiếu!";"en"===a&&(m="Sorry, Product Listings Are Unavailable, Or Product Information Is Missing!"),alert(m)}else if(1==t){var V="Xin lỗi, danh s\xe1ch sản phẩm c\xf3 chứa sản phẩm vượt qu\xe1 gi\xe1 trị cho ph\xe9p của h\xf3a đơn!";"en"===a&&(V="Sorry, The Product List Contains Products That Exceed The Allowed Value Of The Invoice"),alert(V)}else{var g="Xin lỗi, danh s\xe1ch sản phẩm c\xf3 chứa sản phẩm vượt qu\xe1 gi\xe1 trị chiết khấu cho ph\xe9p!";"en"===a&&(g="Sorry, The product list contains products that exceed the allowed discount value"),alert(g)}return!1}c=submitProducts_ext(c),$("#PubDatasource").val(JSON.stringify(c)),$("#DiscountAmount").val(Math.round(A).format(0,3,typeCurrency).replaceAll(".",""));var d,p=new Date,S=String(p.getDate()).padStart(2,"0"),R=S+"/"+String(p.getMonth()+1).padStart(2,"0")+"/"+p.getFullYear();void 0!=$("#dateTimeClient").val()&&$("#dateTimeClient").val(R);var f=parseInt($("#isArisingDate").val()||"0");return""==$("#ArisingDate").val()&&1==f?($("#ArisingDate").val(R),$("#defaultArisingDate").val(R)):""==$("#ArisingDate").val()&&0==f&&($("#ArisingDate").attr("name","ArisingDate_remove"),$("#defaultArisingDate").attr("name","defaultArisingDate_remove")),""!=$("#ArisingDate").val()&&0==f&&$("#isArisingDate").val(1),$("input[type=text]._number").each(function(a,t){var e=$(this).val();$(this).val(e.replaceAll(".",""))}),!1!=submit_over()};
