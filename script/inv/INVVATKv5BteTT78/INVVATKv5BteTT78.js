console.log("js ext --- phiên bản ngày : 14:50 23/06/2025");
/* INVVATKv5BteTT78.js - 14:50 23/06/2025 */
String.prototype.toFloat=function(){return parseFloat(this.trim())},String.prototype.toInt=function(){return parseInt(this.trim())},String.prototype.dot2Comma=function(){return this.replace(/\./g,",")},String.prototype.comma2dot=function(){return this.replace(/,/g,".")},Number.prototype.ReadNumber=function(t){var e,a=this.valueOf(),n=t,o=a.toString().split(".")[0],r=a.toString().split(".")[1],i=0,u=0,l=0,s="",c=new Array;if((a=0==o?0:a)<0)return"Số tiền âm !";if(0==a&&0==r)return"USD"===t?"Không đô la Mỹ":"EUR"===t?"Không Euro":"CNY"===t?"Không CNY":"Không đồng";if(0==a&&0<r?s=ChuSo[0]:l=0<a?a:-a,8999999999999999<a)return"Sô quá lớn!";for(c[5]=Math.floor(l/1e15),isNaN(c[5])&&(c[5]="0"),l-=1e15*parseFloat(c[5].toString()),c[4]=Math.floor(l/1e12),isNaN(c[4])&&(c[4]="0"),l-=1e12*parseFloat(c[4].toString()),c[3]=Math.floor(l/1e9),isNaN(c[3])&&(c[3]="0"),l-=1e9*parseFloat(c[3].toString()),c[2]=parseInt(l/1e6),isNaN(c[2])&&(c[2]="0"),c[1]=parseInt(l%1e6/1e3),isNaN(c[1])&&(c[1]="0"),c[0]=parseInt(l%1e3),isNaN(c[0])&&(c[0]="0"),u=i=0<c[5]?5:0<c[4]?4:0<c[3]?3:0<c[2]?2:0<c[1]?1:0;0<=u;u--){var d=!1;c[u].toString().length<3&&u<i&&(d=!0),e=DocSo3ChuSo(c[u],d),d=!1,s+=e,0<c[u]&&(s+=Tien[u]),0<u&&0<e.length&&(s+=",")}return","==s.substring(s.length-1)&&(s=s.substring(0,s.length-1)),void 0!==r&&0!==parseFloat(r)?(r+="00",o=DocSo3ChuSo(r.substring(0,2),!1),"VND"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" đồng":"USD"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" đô la Mỹ và "+o+" xu":"EUR"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" euro và "+o+" xu":"CNY"==n&&(s=s.substring(1,2).toUpperCase()+s.substring(2)+" tệ và "+o+" hào")):"VND"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" đồng":"USD"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" đô la Mỹ":"EUR"==n?s=s.substring(1,2).toUpperCase()+s.substring(2)+" euro":"CNY"==n&&(s=s.substring(1,2).toUpperCase()+s.substring(2)+" tệ"),s.replace(/\s\s+/g," ")},jQuery.fn.ForceNumericOnly=function(){return this.each(function(){$(this).blur(function(){"NaN"==$(this).val()&&$(this).val(0)}),$(this).keypress(function(t){var e=$(this).attr("class"),a=null,n="3"==$("#INV_TYPE").val()||"4"==$("#INV_TYPE").val()||"6"==$("#INV_TYPE").val();if(window.event){if(a=window.event.keyCode,-1<e.indexOf("number")||-1<e.indexOf("quantity"))return(45==a&&n||!(a<48&&46!=a&&44!=a&&45!=a||57<a&&189!=a))&&checkDotComma(t.target.value,a)}else{if(8===(a=t.which))return;if(-1<e.indexOf("number")||-1<e.indexOf("quantity"))return(45==a&&n||!(46!=a&&44!=a&&45!=a&&isDieuChinhGiamTT||a<48&&46!=a&&44!=a&&45!=a&&isDieuChinhGiamTT||57<a&&189!=a))&&checkDotComma(t.target.value,a)}})})},this.typeCurrency="";var lstPaymentMethodAddon=[],BteGlobal={NEW_ROW_STR:"",ROUND_TOTAL:0,IS_EDIT:0==location.pathname.toLocaleLowerCase().indexOf("/einvoice/edit"),IS_SIGN_REPLACE_TOKEN:"/adjust/createreplaceinvwithtoken"==location.pathname.toLocaleLowerCase(),IS_SIGN_ADJSUT_TOKEN:"/adjust/createadjustinvwithtoken"==location.pathname.toLocaleLowerCase(),PATTERN_TYPE:"1",IS_DIEU_CHINH_AM:!1,IS_DIEU_CHINH_TANG_GIAM:!1,isSubmited:!1,isChiecKhauThuongMai:!1};function mainREADY(){var t;$("#Name").attr("readonly",!0),0<$("#NBKE").length&&""==$("#NBKE").val()&&$("#NBKE").val("01/01/1957"),0<$('input[value="Xem bản nháp"]').length&&$('input[value="Xem bản nháp"]').attr("onclick","ViewDetailInv('ViewDetailInv')"),BteGlobal.IS_DIEU_CHINH_AM="3"==$("#INV_TYPE").val(),BteGlobal.IS_DIEU_CHINH_TANG_GIAM="6"==$("#INV_TYPE").val(),cauHinhSoLe(),typeCurrency=$("#CurrencyUnit").val(),searchCusName(),searchCodeCus(),"/adjust/createadjustinvwithtoken"===location.pathname.toLowerCase()?console.log("Ký token - không tính toán lại dữ liệu"):(bindEvents2Table(),setEventPageReady(),changeVAT(),$("#CusAddress").keyup(function(){checkTextMaxLength(this)}),$("input[type=text]:first").focus(),checkTaxCode(),$(".formatTaxCode").formatTaxCode(),loadCurrencyUnit(),changeCurrencyUnit(),changeExchangeRate(),$("#moneySymbol")[0].innerHTML=typeCurrency,$("#ArisingDate").change(function(){var t=$("#ArisingDate").val();null==Date.parseExact(t,"d/M/yyyy")&&null!=t&&(t=localStorage.getItem("VNPT_localization"),alert("en"===t?"The date is not in the correct format":"Ngày không đúng định dạng"),$("#ArisingDate").val($("#defaultArisingDate").val()))}),BteGlobal.NEW_ROW_STR=getProductRowStr(),BteGlobal.ROUND_TOTAL="VND"==$("#CurrencyUnit").val()?0:2,BteGlobal.PATTERN_TYPE=$("#patternTypeNum").val(),BteGlobal.IS_INV_NO_VAT="2"==$("#patternTypeNum").val(),BteGlobal.PATTERN_NUM=$("#Pattern").val().replace("/",""),BteGlobal.IS_INV_NO_VAT&&($("#VATRateItem").val("-4"),$("#VATRate").val("-4")),""!=(t=$("#EX_CurrencyUnit").val())&&"VND"!=t&&t!=$("#urrencyUnit").val()&&$("#CurrencyUnit").val($("#EX_CurrencyUnit").val()),addExtra10(),fillExtra(),fillPaymentMethod(),changePosExtra(),cauHinhThueSuatTOKEN(),"true"==localStorage.getItem(BteGlobal.PATTERN_NUM+"hideDiscountOpt")&&1==CheckDiscountEmpty()&&$("#hideDiscountOpt").prop("checked",!0).trigger("change"),0<$(".mask-cccd").length&&$(".mask-cccd").mask("0000 0000 0000"),0<parseInt($("#HDDThu").val()||"-1")&&$("#DivHDDThu").show(),0<$("#CheckBoxTCHDon").length&&(BteGlobal.isChiecKhauThuongMai=$("#CheckBoxTCHDon").is(":checked")))}function setEventPageReady(){}function addExtra10(){var t;document.querySelector("#Extra10")||(t=function(){document.querySelector("#Extra10")||($("#ConvertedAmount").after('<input  class="textr Extra10_ConvertedAmount" title="Đang lưu thẻ Extra10" id="Extra10"  name="Extra10" maxlength="50" type="text" value="0" style="">'),$(".Extra10_ConvertedAmount").on("change.Extra10",function(){$("#ConvertedAmount").val($("#Extra10").val()),$("#ConvertedAmount").attr("value",$("#Extra10").val())})),$("#ConvertedAmount").hide(),""!=$("#ConvertedAmount").val()&&0!=$("#ConvertedAmount").val().FormatNumUK()&&$("#Extra10").val($("#ConvertedAmount").val())},"VND"!=$("#CurrencyUnit").val()&&t(),$("#CurrencyUnit").on("change.Extra10",function(){"VND"==$(this).val()?$(".Extra10_ConvertedAmount").remove():t()}),$("#AmountInWords , #ExchangeRate").on("change.Extra10",function(t){"VND"!=$("#CurrencyUnit").val()?($("#Extra10").val($("#ConvertedAmount").val()),$("#Extra10").attr("value",$("#ConvertedAmount").val()),$(".Extra10_ConvertedAmount").trigger("change.Extra10")):$(".Extra10_ConvertedAmount").remove()}),$('input[type="submit"]').on("mousedown",function(){var t=$(".Extra10_ConvertedAmount").val()||"";$(".Extra10_ConvertedAmount").val(t.FormatNumUK())}))}function SumAmountProduct(){return vTotal=0,vDiscountAmount=0,$("table.products tbody .amount").each(function(t,e){var a=parseInt($(e).parents("tr").eq(0).find(".Issum").val()||"-1"),n=($(e).val()||"0").FormatNumUK();vDiscountAmount+=($(e).parent().parent().find(".discountamount").val()||"0").FormatNumUK(),0==a||5==a?vTotal+=($(e).val()||"0").FormatNumUK():2==a&&(vTotal-=($(e).val()||"0").FormatNumUK(),vDiscountAmount+=n)}),{Total:vTotal,DiscountAmount:vDiscountAmount}}function getListProductString(){var v=[],p=0,g=0;return $("table.products tbody tr").each(function(t,e){var a={},n=$(e).find("input[type=text].name");if(""!=(n=0==n.length?$(e).find("textarea.name"):n).val().trim()){var o=$(e).find("input[type=text].unit"),r=$(e).find("input[type=text].quantity"),i=$(e).find("input[type=text].price"),u=$(e).find("input[type=text].discount"),l=$(e).find("input[type=text].discountamount"),s=$(e).find("input[type=text].amount"),c=$(e).find(":selected:first"),d=$(e).find("input.VATRate:first"),m=$(e).find("input[type=text].code:first"),h=parseInt($("#HDDThu").val()||"-1");if(s.val()||n.val()){if(a.ProdType=1,a.Name=(n.val()||"").replace(/\n/gim," ").trim(),a.Unit=(o.val()||"").trim(),a.Quantity=(r.val()||"0").replace(/\./g,""),a.Price=(i.val()||"0").replace(/\./g,""),a.Discount=(u.val()||"0").replace(/\./g,""),a.DiscountAmount=(l.val()||"0").replace(/\./g,""),a.Total=(s.val()||"0").replace(/\./g,""),a.IsSum=parseInt(c.val()||"0"),"-4"==$("#VATRate").val()?a.VATRate=-4:a.VATRate=d.val(),a.Code=(m.val()||"").trim(),g+=(l.val()||"0").FormatNumUK()||0,parseFloat(a.VATRate)<0?a.VATAmount=0:a.VATAmount=(parseFloat(a.VATRate)*parseFloat(a.Total.FormatNumUK())/100).toFixed(BteGlobal.ROUND_TOTAL),a.Amount=(parseFloat(a.VATAmount)+parseFloat(a.Total.FormatNumUK())).toFixed(BteGlobal.ROUND_TOTAL),parseFloat(a.Amount)<0&&"3"!=$("#INV_TYPE").val()&&(a.Amount=-1*a.Amount),""!=a.Amount&&""==a.Name.trim())return p=0,_products.length=0,!1;if(18<a.Amount.toString().length||0<=a.Amount.toString().indexOf("e")||0<a.Price&&(18<a.Price.toString().length||0<=a.Price.toString().indexOf("e"))||0<a.Quantity&&(18<a.Quantity.toString().length||0<=a.Quantity.toString().indexOf("e")))return p=1,_products.length=0,!1;if(100<a.Discount.FormatNumUK())return p=2,_products.length=0,!1;0!=parseFloat(a.VATAmount)&&(a.VATAmount=a.VATAmount.toString().FormatNumUK2VN()),0!=parseFloat(a.Amount)&&(a.Amount=a.Amount.toString().FormatNumUK2VN());n=-1==$("table.products th.Extra1TH").attr("class").indexOf("hide"),o=-1==$("table.products th.Extra2TH").attr("class").indexOf("hide"),r=-1==$("table.products th.RemarkTH").attr("class").indexOf("hide");n&&(i=$(e).find("input.extra1"),a.Extra1=i.val(),-1<i.attr("class").indexOf("_number"))&&""!=a.Extra1&&(a.Extra1=a.Extra1.FormatNumUK()),o&&(u=$(e).find("input.extra2"),a.Extra2=u.val(),-1<u.attr("class").indexOf("_number"))&&""!=a.Extra2&&(a.Extra2=a.Extra2.FormatNumUK()),r&&(s=$(e).find("input.remark"),a.Remark=s.val(),-1<s.attr("class").indexOf("_number"))&&""!=a.Remark&&(a.Remark=a.Remark.FormatNumUK()),5==a.IsSum&&(1===h?(a.SKhung=($(e).find("input[type=text].SKhung").val()||"").trim(),a.SMay=$(e).find("input[type=text].SMay").val()||"",a.SMay=a.SMay.trim(),a.LHHDTrung=h):2===h?(a.BKSPTVChuyen=$(e).find("input[type=text].BKSPTVChuyen").val()||"",a.BKSPTVChuyen=a.BKSPTVChuyen.trim(),a.LHHDTrung=h):3===h&&(a.TNGHang=$(e).find("input[type=text].TNGHang").val()||"",a.DCNGHang=$(e).find("input[type=text].DCNGHang").val()||"",a.MSTNGHang=$(e).find("input[type=text].MSTNGHang").val()||"",a.MDDNGHang=$(e).find("input[type=text].MDDNGHang").val()||"",a.TNGHang=a.TNGHang.trim(),a.DCNGHang=a.DCNGHang.trim(),a.MSTNGHang=a.MSTNGHang.trim(),a.MDDNGHang=a.MDDNGHang.trim(),a.LHHDTrung=h)),v.push(a)}}}),{productList:v,check:p,discountAmount:g}}function showExtraProcut(t){$("table.products th."+t+"TH").removeClass("hide"),$("table.products td.col-"+t).removeClass("hide")}function getProductRowStr(){return"<tr>"+$("table.products tbody tr:last").html().trim()+"</tr>"}function apendLastRow(t){var e=$("table.products tbody tr").length-1,e=$("table.products tbody tr").eq(e).find("td").eq(1).text().trim(),t=($("table.products tbody").append(t),$("table.products tbody tr:last"));""==e.trim()||isNaN(parseInt(e))?(e=1,t.find("td").eq(1).text("")):(e=parseInt(e)+1,t.find("td").eq(1).text(e.toString())),t.find("#IsSum").val(0),t.find("input").each(function(t,e){$(e).attr("class")&&-1<$(e).attr("class").indexOf("VATRate")||$(e).val("")})}function checkMstCusName(){return""==$("#CusTaxCode").val()||""!=$("#CusName").val().trim()||(alert('Bắt buộc nhập "Tên đơn vị mua hàng" nếu có nhập Mã số thuế Khách hàng'),!1)}function checkCusNameBuyer(){return""!=$("#Buyer").val().trim()||""!=$("#CusName").val().trim()||(alert("Hóa đơn chưa nhập Tên đơn vị hoặc Người mua hàng"),!1)}function checkFormSubmit(){if(0<$("#MDVQHNSACH_NMUA").length){if(""==$("#MDVQHNSACH_NMUA").val())return!0;var t=$("#MDVQHNSACH_NMUA").val().trim();if(""!=t&&""==$("#CusName").val().trim()&&""==$("#CusAddress").val().trim())return alert('Bắt buộc nhập "Tên đơn vị" + Địa chỉ của bên mua,  nếu có nhập  "Mã đơn vị quan hệ ngân sách" '),!1;if(null==t.match(/^[12378]\d{6}$/g))return alert("Mã đơn vị quan hệ ngân sách có độ dài 7 ký tự và bắt đầu bằng 1, 2, 3, 7 hoặc 8!"),!1}return!0}function submitProducts_ext(t){return t}function submit_over_begin(){}function submit_over(){return!0}function onLastRowFous(){$("table.products tbody input:text").change(function(){var a,t=$(this),e=t.parents("tbody").children("tr").length;t.parents("tr:first").children("td:nth-child(2)").text()==e&&(a=!1,t.parents("tr:first").find("input:text").each(function(t,e){$(e).val()&&(a=!0)}),a)&&(apendLastRow(BteGlobal.NEW_ROW_STR),bindEvents2Table())})}function autocompleteProductName(o){var r="name"==(o=o||"name")?"Name":"Code";$("table.products tbody input."+o).data("autocomplete_on",!1).bind("autocompleteopen",function(t,e){$(this).data("autocomplete_on",!0)}).bind("autocompleteclose",function(t,e){$(this).data("autocomplete_on",!1)}).autocomplete({source:function(a,n){console.log("request.term",a),a.term=a.term||"",a.term=a.term.toLowerCase(),$.ajax({type:"POST",url:"/Product/SeachBy"+r,dataType:"JSON",data:{searchText:a.term},success:function(t){null===t&&("name"==o?$(this).parents("tr:first").find("input.Code"):$(this).parents("tr:first").find("input.Name")).val("");var e=[],e="code"==o?e.concat(t.filter(t=>0==t.Code.toLowerCase().indexOf(a.term)).slice(0,5)).concat(t.filter(t=>1==t.Code.toLowerCase().indexOf(a.term)).slice(0,3)).concat(t.filter(t=>3==t.Code.toLowerCase().indexOf(a.term)).slice(0,3)).concat(t.filter(t=>1<t.Code.toLowerCase().indexOf(a.term)).slice(0,5)):e.concat(t.filter(t=>0==t.Name.toLowerCase().indexOf(a.term)).slice(0,5)).concat(t.filter(t=>1==t.Name.toLowerCase().indexOf(a.term)).slice(0,3)).concat(t.filter(t=>3==t.Name.toLowerCase().indexOf(a.term)).slice(0,3)).concat(t.filter(t=>0<t.Name.toLowerCase().indexOf(a.term)).slice(0,5));n($.map(e,function(t){return{label:t.Code+" | "+t.Name,Name:t.Name,Unit:t.Unit,Price:t.Price,Code:t.Code}}))}})},minLength:1,select:function(t,e){return $(this).parents("tr:first").find("input.unit").val(e.item.Unit),"name"==o?$(this).parents("tr:first").find("input.code").val(e.item.Code):$(this).parents("tr:first").find("input.name").val(e.item.Name),$(this).parents("tr:first").find("input.price").val(e.item.Price.toString().replace(".",",")).trigger("focusout"),(9!=t.which||9!=t.keyCode?$(this).parents("tr:first").find("input.quantity"):$(this).parents("tr:first").find("input.unit")).focus(),$(this).val(e.item[r]).trigger("change"),!1},appendTo:"#searchAutocomplete",open:function(){var t=$(this).position(),e=t.left,t=t.top+20;$("#searchAutocomplete > ul").css({left:e+"px",top:t+"px"})}})}function onSumAmountProduct(){$(`table.products tbody .quantity 
          , table.products tbody .price
          , table.products tbody .discountamount
          ,table.products tbody .Issum`).change(function(t){var e,a,n,o,r,i=parseInt($("#TotalFomular").val()||1);2==i&&-1<$(t.target).attr("class").indexOf("price")||3==i&&-1<$(t.target).attr("class").indexOf("quantity")||(e=((t=$(this).parents("tr:first")).find("input.price").val()||"0").FormatNumUK(),a=(t.find("input.quantity").val()||"0").FormatNumUK(),n=$("#totalRound").val(),o=(t.find("input.discountamount").val()||"0").FormatNumUK(),3==i?(r=t.find("input.amount").val().FormatNumUK()||0,0!=e&&(a=BteGlobal.IS_DIEU_CHINH_TANG_GIAM?r/e:Math.abs(r/e),t.find("input.quantity").attr("value",a.toFixed(n)),t.find("input.quantity").val(a.toFixed(n).toFloat().format(0,3,typeCurrency)))):2==i?(r=t.find("input.amount").val().FormatNumUK()||0,0!=a&&(e=BteGlobal.IS_DIEU_CHINH_TANG_GIAM?r/a:Math.abs(r/a),t.find("input.price").attr("value",e.toFixed(n)),t.find("input.price").val(e.toFixed(n).toFloat().format(0,3,typeCurrency)))):(r=Math.abs(a*e)-o,a*e<0&&(r=+Math.abs(r)),t.find("input.amount").attr("title",r.toString()),i=(r="3"==$("#INV_TYPE").val()?-1*Math.abs(r):r).toFixed(n).toFloat().format(0,3,typeCurrency),t.find("input.amount").val(i).trigger("change")),onSumAmountProduct_ext())}),onSumAmountProduct_over()}function onSumAmountProduct_ext(){}function onSumAmountProduct_over(){}function onDiscountProductChange(){$("table.products tbody .discount").change(function(){var t=$(this).parents("tr:first"),e=t.find("input.name").val(),a=(t.find("input.price").val().FormatNumUK()||0)*(t.find("input.quantity").val().FormatNumUK()||0)*(t.find("input.discount").val().FormatNumUK()||0)/100;(0<a?t.find("input.discountamount").val(a.toFixed($("#totalRound").val()).toString().FormatNumUK2VN()):""!=e?t.find("input.discountamount").val(0):t.find("input.discountamount").val("")).trigger("change")}),onDiscountProductChange_over()}function onDiscountProductChange_over(){}function onIssumProductChange(){$("table.products tbody .Issum").change(function(t){var e=$(this).parents("tr");"5"==$(this).val()?(e.find("td.tb-HDDThu input").removeAttr("readonly"),e.find("td.tb-HDDThu input").removeClass("bg-gray")):(e.find("td.tb-HDDThu input").attr("readonly",!0),e.find("td.tb-HDDThu input").val(""),e.find("td.tb-HDDThu input").addClass("bg-gray")),"2"==$(this).val()?(e.find(".discount").val(""),e.find(".discountamount").val(""),e.find(".discount").attr("disabled","disabled"),e.find(".discountamount").attr("disabled","disabled")):(e.find(".discount").attr("disabled",!1),e.find(".discountamount").attr("disabled",!1))})}function onSumTotal(){$(`table.products tbody .amount,
        table.products tbody .Issum`).change(function(t){var e=$("#CurrencyUnit").val()||"VND",a=0,n=0,o=$("#INV_TYPE").val()||"0",r=($(t.target).parents("tr").find(".amount").val()||"0").FormatNumUK(),o=("3"==o&&-1==r.toString().indexOf("-")&&0<r&&$(t.target).parents("tr").find(".amount").val("-"+r.format(0,3,typeCurrency)),a=(d=SumAmountProduct()).Total,n=d.DiscountAmount,parseInt($("#TotalFomular").val()||"1"));2==o?$(t.target).closest("tr").find(".quantity").trigger("change"):3==o&&$(t.target).parents("tr").eq(0).find(".price").trigger("change"),"VND"==e&&(a=a.toFixed(BteGlobal.ROUND_TOTAL).toFloat()),BteGlobal.isChiecKhauThuongMai&&(a=-1*Math.abs(a)),$("#Total").val(a.format(0,3,typeCurrency)).trigger("change"),$("#DiscountAmount").val(n.toFixed().toFloat().format(0,3,typeCurrency)).trigger("change"),onSumTotal_ext()}),onSumTotal_over()}function onSumTotal_ext(){}function onSumTotal_over(){}function ChangeVATRateF(){$("#VATRateItem").trigger("change")}function changePosExtraInput(){}function nhapSTT(){$("table.products tr td.delr").each(function(t,e){var a=$(this).parents("tr"),n=a.find("td").eq(1),o=a.find("td.col-Remark");o.removeClass("hide"),o.addClass("text-center"),o.find("input").addClass("text-center"),o.find("input").removeClass("textr"),n.after(o),a.find("td.col-Remark").eq(1).remove()}),$("table.products tr td.delr").each(function(t,e){var a=$(this).parents("tr");a.find("td").eq(1).hide(),a.find("td.col-Remark");a.find("td.col-Remark").eq(1).remove()}),$("table.products tr th").eq(1).hide();var t=$("table.products tr th.RemarkTH");t.removeClass("hide"),t.text("STT"),t.css({width:"30px"}),t.addClass("text-center"),$("table.products tr th").eq(1).after(t),BteGlobal.NEW_ROW_STR=getProductRowStr()}function configTableProduct(t){if(t&&0!=t.length&&t[0].tag){for(var e=0;e<t.length;e++){var a=t[e],n=parseInt(a.pos),o="."+a.tag,r=$("table.products th."+a.tag+"TH");0==$("table.products "+o.toLowerCase()).length&&console.log(" Tag: "+o+" not found"),r.removeClass("hide"),a.header&&r.html(a.header),a.width&&""!=a.width&&r.css("width",a.width),!isNaN(n)&&0<n&&($("table.products th").eq(n).before($("table.products th."+a.tag+"TH")),$("table.products tr").each(function(){var t=$(this).find(o.toLowerCase()).parents("td");t.removeClass("hide"),$(this).find("td").eq(n).before(t.eq(0))})),a.classInput&&$("table.products tr").each(function(){var t=$(this).find(o.toLowerCase());t.attr("class",a.tag.toLowerCase()),t.addClass(a.classInput)}),"1"==a.hide&&($("table.products th."+a.tag+"TH").addClass("hide"),$("table.products tr").each(function(){var t=$(this).find(o.toLowerCase());t.parents("td").eq(0).addClass("hide"),t.addClass("hide")}))}BteGlobal.NEW_ROW_STR=getProductRowStr()}}function resetValNumProduct(){$("#bodyTblProduct input._number[value]").each(function(t,e){var a=$(e).attr("value"),n=$(e).attr("class");a&&-1==n.indexOf("amount")&&$(e).val(a.trim().replace(".",","))})}function setAmDonGia(){"3"==$("#INV_TYPE").val()&&$("table.products tbody input.price._number").each(function(){var t=$(this).val()||"0";0<t.FormatNumUK()&&""!=t&&"0"!=t&&$(this).val(parseFloat("-"+Math.abs(t.FormatNumUK())).format(2,3,typeCurrency,!0))})}function CheckDiscountEmpty(){var t=($("#DiscountNonTax").val()||"0").FormatNumUK(),e=($("#DiscountOther").val()||"0").FormatNumUK();return 0==t&&0==e||($("#DiscountNonTax").parents(".line").eq(0).show().removeClass("hidden"),$("#DiscountOther").parents(".line").eq(0).show().removeClass("hidden"),!1)}function ViewDetailInv(){var t;return!!$("form:first").valid()&&0!=submit("ViewDetailInv")&&(t="/Share/ajxPreviewCreateInv",0==location.pathname.toLocaleLowerCase().indexOf("/adjust/")&&(t="/Share/ajxPreviewAdjust"),void $.ajax({type:"POST",url:t,data:$("form:first").serialize(),success:function(t){$("#container").html(t+"<div class='pagination'><span id='prev' class='prevnext'><</span><span id='next' class='prevnext'></span></div>"),$(function(){$("#4plugin").remove(),$("#plugin0").remove(),$("#ViewInvoice").bPopup({easing:"easeOutBack",speed:450,transition:"slideDown"}),2==$(".pagination span").length&&$("#quantitypages").ProductNumberPagination({number:1})}),$("#ArisingDate").attr("name","ArisingDate"),$("#defaultArisingDate").attr("name","defaultArisingDate")}}))}function viewDetail(){if(!$("form:first").valid())return!1;submit();var t=$("form:first").serializeArray();$.ajax({type:"POST",url:"/Share/ajxPreviewAdjust",data:t,success:function(t){var e="en"===localStorage.getItem("VNPT_localization")?"Print Invoice":"In hóa đơn";$("#container").html(t+"<div class='pagination'><span id='prev' class='prevnext'><</span><span id='next' class='prevnext'>></span><input type='button' style='float:right' class='button' value='"+e+"' id='convertPagination' onclick=\"printScrAdJust();\" /></div>"),$(function(){$("#4plugin").remove(),$("#plugin0").remove(),$("#ViewInvoice").bPopup({easing:"easeOutBack",speed:450,transition:"slideDown"}),2==$(".pagination span").length&&$("#quantitypages").ProductNumberPagination({number:1})})}})}function cauHinhSoLe(){var t="CF_"+$(".mst").text().replace(/ /g,"").trim()+$("#Pattern").val().replace(/\//g,""),e={};localStorage[t]&&(e=JSON.parse(localStorage[t])).NumberBehindComma2&&""!=e.NumberBehindComma2&&($("#NumberBehindComma").val(e.NumberBehindComma2),$("#NumberBehindComma").attr("value",e.NumberBehindComma2)),$("#totalRound").change(function(){$("table.products .quantity").trigger("focusin").trigger("focusout").trigger("change"),e.totalRound=$("#totalRound").val(),localStorage[t]=JSON.stringify(e)}),$("#NumberBehindComma2").change(function(){$("#NumberBehindComma").val($("#NumberBehindComma2").val()).trigger("change"),e.NumberBehindComma2=$("#NumberBehindComma2").val(),localStorage[t]=JSON.stringify(e),formatTagInputNumber(typeCurrency)}),$("#TotalFomular").change(function(){e.TotalFomular=$("#TotalFomular").val(),localStorage[t]=JSON.stringify(e)}),e.NumberBehindComma2&&($("#NumberBehindComma2").val(e.NumberBehindComma2).trigger("change"),$("#NumberBehindComma").val(e.NumberBehindComma2)),e.totalRound?$("#totalRound").val(e.totalRound):$("#totalRound").val($("#NumberBehindComma").val()),e.TotalFomular&&$("#TotalFomular").val(e.TotalFomular).trigger("change"),"/AdJust/CreateReplaceInvWithToken"!=location.pathname&&0!=location.pathname.indexOf("/EInvoice/Edit/")&&formatTagInputNumber(typeCurrency)}function checkReuireEx(){var a=!0,n="";return $('input.requiredEx[type!="checkbox"]').each(function(t,e){""==$(e).val()&&a&&($(e).addClass("error"),document.getElementById(e.id).scrollIntoView(),n+=$(e).closest(".line").text()+"\n ",a=!1)}),n&&alert(`Bạn chưa nhập dữ liệu bắt buộc 
`+n),a}function fillExtra(){for($("#Extra__")&&$("#Extra").val($("#Extra__").val()),i=1;i<=12;i++){var t=$("#Extra__"+i).val();$("#Extra"+i).val(t)}}function fillPaymentMethod(){var e,a=[];if(0==$("#PaymentMethodDropdown").length)return!1;$("#PaymentMethodDropdown option").toArray().map(t=>{a.push($(t).val())}),void 0!==lstPaymentMethodAddon&&lstPaymentMethodAddon&&0<lstPaymentMethodAddon.length&&(e="",lstPaymentMethodAddon.map(function(t){-1<a.indexOf(t.value)||(e+='<option value="'+t.value+'">'+t.text+"</option>")}),$("#PaymentMethodDropdown").append(e),void 0!==invoiceDataBte.PaymentMethod)&&""!=invoiceDataBte.PaymentMethod&&$("#PaymentMethodDropdown").val(invoiceDataBte.PaymentMethod)}function changePosExtra(){for(i=1;i<=12;i++){var t;$("#Extra"+i)&&$("#Extra"+i).attr("data-pos")&&(t=$("#Extra"+i).attr("data-pos"),$(".rInput").eq(t).after($("#Extra"+i).closest(".line")))}}function cauHinhThueSuatTOKEN(){0!=parseInt($("#Amount").val().replace(",","").replace(".",""))&&(BteGlobal.IS_SIGN_REPLACE_TOKEN||BteGlobal.IS_SIGN_ADJSUT_TOKEN)&&($("#VATRateItem").val($("#EX_VATRate").val()).trigger("change"),$("#VATAmount").val($("#VATAmount").attr("value")),$("#Amount").val($("#Amount").attr("value")))}function InvoiceAjustReduce(){"3"==$("#INV_TYPE").val()&&$("table.products tr td .amount ").each(function(t,e){var a=($(e).val()||"0").FormatNumUK();0<a&&$(e).val("-"+$(e).val()).trigger("change")})}$(document).ready(function(){mainREADY()}),$("#btnAddRow").on("click",function(){apendLastRow(BteGlobal.NEW_ROW_STR),bindEvents2Table()}),this.dieuHuong=function(){$("table.products tbody input").bind("keydown.nav",function(t){var e=0,a=($(this).is(":checkbox")||(e=this.selectionStart),$(this).val().length),n=$(this).parents("td:first").index(),o=$(this).parents("tr:first").index();if(13==t.which||13==t.keyCode)return!1;if(!$(this).data("autocomplete_on"))switch(t.which||t.keyCode){case 37:if($(this).is(":checkbox")||!$(this).val()||!$(this).is(":checkbox")&&e<=0)return r=$("table.products tbody").children("tr:nth-child("+(o+1)+")"),0<$(r).children("td:nth-child("+n+")").children("input:first").focus().length&&$(this).trigger("change").trigger("blur"),!1;break;case 38:var r=$("table.products tbody").children("tr:nth-child("+o+")");return 0<$(r).children("td:nth-child("+(n+1)+")").children("input:first").focus().length&&$(this).trigger("change").trigger("blur"),!1;case 39:if($(this).is(":checkbox")||!$(this).val()||!$(this).is(":checkbox")&&a<=e)return r=$("table.products tbody").children("tr:nth-child("+(o+1)+")"),0<$(r).children("td:nth-child("+(n+2)+")").children("input:first").focus().length&&$(this).trigger("change").trigger("blur"),!1;break;case 40:r=$("table.products tbody").children("tr:nth-child("+(o+2)+")");return 0<$(r).children("td:nth-child("+(n+1)+")").children("input:first").focus().length&&$(this).trigger("change").trigger("blur"),!1}})},this.checkTaxCode=function(){$("#CusTaxCode").blur(function(){var e=$(this);$("#errorTaxCode").remove(),e.val()?$.ajax({type:"POST",url:"/Company/checkMST/",data:{mst:$(this).val()},success:function(t){t?(e.removeClass("error"),$("#CusAddress").addClass("required"),$("#lbCusAddress").addClass("imp")):e.addClass("error").parent(".control").append('<label id="errorTaxCode" for="CusTaxCode" generated="true" class="error">Mã số thuế không hợp lệ</label>')}}):(e.removeClass("error"),$("#CusAddress").removeClass("required"),$("#lbCusAddress").removeClass("imp"))})},this.submit=function(t){var e=($("#AmountInWords").val()||"").trim(),e=(""!=e&&$("#AmountInWords").val(e[0].toUpperCase()+e.slice(1).toLowerCase()),localStorage.getItem("VNPT_localization")||"vi");if($('input[type="submit"]').hide(),BteGlobal.isSubmited)return alert("Đã nhấn nút -  Điều chỉnh / Tạo mới 2 lần vui lòng đợi..."),!1;if(BteGlobal.isSubmited=!0,"string"==typeof t&&"ViewDetailInv"===t||"string"==typeof t&&"printScrAdJust"===t?($('input[type="submit"]').show(),BteGlobal.isSubmited=!1):$("#CheckBoxTCHDon").prop("checked")||($("#SBKE").attr("name","SBKE_REMOVE"),$("#NBKE").attr("name","NBKE_REMOVE")),!checkMstCusName())return $('input[type="submit"]').show(),BteGlobal.isSubmited=!1;if(!checkFormSubmit())return $('input[type="submit"]').show(),BteGlobal.isSubmited=!1;submit_over_begin();$("#VatAmount0").val("0"),$("#VatAmount5").val("0"),$("#VatAmount10").val("0"),$("#GrossValue").val("0"),$("#GrossValue0").val("0"),$("#GrossValue5").val("0"),$("#GrossValue10").val("0"),$("#GrossValueNonTax").val("0"),$("#VATAMOUNTOTHER").val("0"),$("#GROSSVALUEOTHER").val("0"),$("#VatAmount8").val("0"),$("#GrossValue8").val("0");var t=$("#Total").val().FormatNumUK(),a=$("#VATAmount").val().FormatNumUK(),n=$("#VATRateItem").val().toFloat(),o=$("#VATRateF").val();if((-99==n&&""!=o&&(o=o.FormatNumUK(),-1<[0,5,8,10,-1,-2].indexOf(o))&&($("#VATRateItem").val(o),$("#VATRateF").val(""),n=o),0<(n=BteGlobal.IS_INV_NO_VAT?-4:n)?10==n?($("#VatAmount10").val(a.toString().replaceAll(".",",")),$("#GrossValue10").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)):5==n?($("#VatAmount5").val(a.toString().replaceAll(".",",")),$("#GrossValue5").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)):8==n&&($("#VatAmount8").val(a.toString().replaceAll(".",",")),$("#GrossValue8").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)):-99==n?(o=$("#VATRateF").val(),""!=$("#VATRateF").val()&&null!=$("#VATRateF").val()||(o=-3,$("#VATRateF").val(o),$("table.products .VATRate").val(o)),n=parseFloat(o||"0"),$("#VATAMOUNTOTHER").val(a.toString().replaceAll(".",",")),$("#GROSSVALUEOTHER").val(t.toString().replaceAll(".",",")),$("#VATRate").val($("#VATRateF").val())):-1==n?($("#GrossValue").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)):0==n?($("#VatAmount0").val("0"),$("#GrossValue0").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)):-2==n&&($("#GrossValueNonTax").val(t.toString().replaceAll(".",",")),$("#VATRate").val(n)),0<$("#errorTaxCode").length)&&($("#errorTaxCode").show(),$("#CusTaxCode").addClass("error"),!confirm("en"===e?"Sorry, The Customer's Tax Code Is Not Correct. \n- Do You Want To Continue To Save The Invoice?":"Xin lỗi, mã số thuế của khách hàng không chuẩn.\n- Bạn có muốn tiếp tục lưu hóa đơn không?")))return $('input[type="submit"]').show(),BteGlobal.isSubmited=!1;if(2e7<=$("#Total").val().FormatNumUK()&&"CK"!=$("#PaymentMethod").val()){var r="en"===e?"The Amount Is Too Large, You Should Pay For The Transfer. \n- Do You Want To Continue To Save The Invoice?":"Số tiền quá lớn, bạn nên thanh toán chuyển khoản.\n- Bạn có muốn tiếp tục lưu hóa đơn không?";if(!confirm(r))return BteGlobal.isSubmited=!1,$('input[type="submit"]').show(),!1}o=$("#INV_TYPE").val(),a=$("#Amount").val().FormatNumUK(),t=$("#OldAmount").val();if("3"==o&&0<t&&(t=t.FormatNumUK())<=a){r="Bạn đang lập hóa đơn điều chỉnh giảm quá 100% chi tiết hàng hóa trong hóa đơn gốc.\n- Bạn có muốn tiếp tục lưu hóa đơn không?";if(!confirm(r))return BteGlobal.isSubmited=!1,$('input[type="submit"]').show(),!1}"3"==$("#INV_TYPE").val()&&["VatAmount0","VatAmount5","VatAmount10","GrossValue","GrossValue0","GrossValue5","GrossValue10","GrossValueNonTax","VATAMOUNTOTHER","GROSSVALUEOTHER","VatAmount8","GrossValue8"].forEach(function(t){var e=$("#"+t).val();e&&0<e.FormatNumUK()&&$("#"+t).val("-"+e)});if(0<$("#CheckBoxHDDThu").length&&1==$("#CheckBoxHDDThu").prop("checked")){var i=!1;if($("table.products select.Issum").each((t,e)=>{"5"===$(e).val()&&(i=!0)}),0==i)return alert('Nếu check "Hàng hóa đặc trưng" cần Nhập ít nhất 1 sản phẩm có Tính chất hàng hóa đặt trưng'),$('input[type="submit"]').show(),BteGlobal.isSubmited=!1}n=getListProductString(),o=n.productList,t=n.check,a=($("#DiscountAmount").val()||"0").FormatNumUK();if(0==o.length)return 0==t?alert("en"===e?"Sorry, Product Listings Are Unavailable, Or Product Information Is Missing!":"Xin lỗi, danh sách sản phẩm chưa có hoặc thông tin sản phẩm bị thiếu!"):1==t?alert("en"===e?"Sorry, The Product List Contains Products That Exceed The Allowed Value Of The Invoice":"Xin lỗi, danh sách sản phẩm có chứa sản phẩm vượt quá giá trị cho phép của hóa đơn!"):alert("en"===e?"Sorry, The product list contains products that exceed the allowed discount value":"Xin lỗi, danh sách sản phẩm có chứa sản phẩm vượt quá giá trị chiết khấu cho phép!"),BteGlobal.isSubmited=!1,$('input[type="submit"]').show(),!1;o=submitProducts_ext(o),$("#PubDatasource").val(JSON.stringify(o)),$("#DiscountAmount").val(Math.round(a).format(0,3,typeCurrency).replaceAll(".",""));r=new Date,n=String(r.getDate()).padStart(2,"0")+"/"+String(r.getMonth()+1).padStart(2,"0")+"/"+r.getFullYear(),null!=$("#dateTimeClient").val()&&$("#dateTimeClient").val(n),t=parseInt($("#isArisingDate").val()||"0");return""==$("#ArisingDate").val()&&1==t?($("#ArisingDate").val(n),$("#defaultArisingDate").val(n)):""==$("#ArisingDate").val()&&0==t&&($("#ArisingDate").attr("name","ArisingDate_remove"),$("#defaultArisingDate").attr("name","defaultArisingDate_remove")),0<$("#ArisingDate").length&&""!=$("#ArisingDate").val()&&0==t&&$("#isArisingDate").val(1),$("input[type=text]._number, input[type=text].number-negative").each(function(t,e){var a=$(this).val();$(this).val(a.replaceAll(".",""))}),"function"==typeof SetFeeDataSource&&SetFeeDataSource(),0<$("#NBKE").length&&""==$("#NBKE").val()&&$("#NBKE").val("01/01/1957"),0!=submit_over()||(BteGlobal.isSubmited=!1,$('input[type="submit"]').show(),!1)},this.searchCusName=function(){$("#CusName").autocomplete({focus:function(t,e){},minLength:1,select:function(t,e){$("#CusTaxCode").val(e.item.TaxCode),$("#CusAddress").val(e.item.Address),$("#CusPhone").val(e.item.Phone),$("#CusCode").val(e.item.Code),$("#EmailDeliver").val(e.item.EmailDeliver),$("#CusBankName").val(e.item.CusBankName),$("#CusBankNo").val(e.item.CusBankNo),$("#Buyer").val(e.item.Buyer)},source:function(t,e){$.ajax({data:{searchText:t.term},dataType:"JSON",success:function(t){e($.map(t,function(t){if(null!=t.cusname&&""!=t.cusname)return{id:t.cusid,value:t.cusname,TaxCode:t.TaxCode,Address:t.Address,Phone:t.Phone,Code:t.Code,EmailDeliver:t.EmailDeliver,Buyer:t.Buyer,CusBankName:t.CusBankName,CusBankNo:t.CusBankNo}}))},type:"POST",url:"/Customer/SeachByName"})},appendTo:"#searchAutocomplete",open:function(){var t=$(this).position(),e=t.left,t=t.top+20;$("#searchAutocomplete > ul").css({left:e+"px",top:t+"px"})}}).change(function(){$(this).val()||($("#CusTaxCode").val(""),$("#CusAddress").val(""),$("#CusPhone").val(""),$("#CusCode").val(""),$("#EmailDeliver").val(""),$("#Buyer").val()||$("#Buyer").val(""),$("#CusBankName").val(""),$("#CusBankNo").val(""))}),$("#Buyer").autocomplete({focus:function(t,e){},minLength:1,select:function(t,e){$("#CusTaxCode").val(e.item.TaxCode),$("#CusAddress").val(e.item.Address),$("#CusPhone").val(e.item.Phone),$("#CusCode").val(e.item.Code),$("#EmailDeliver").val(e.item.EmailDeliver),$("#CusBankName").val(e.item.CusBankName),$("#CusBankNo").val(e.item.CusBankNo),$("#CusName").val(e.item.cusname)},source:function(t,e){$.ajax({data:{searchText:t.term},dataType:"JSON",success:function(t){e($.map(t,function(t){if(null!=t.Buyer&&""!=t.Buyer)return{id:t.cusid,cusname:t.cusname,TaxCode:t.TaxCode,Address:t.Address,Phone:t.Phone,Code:t.Code,EmailDeliver:t.EmailDeliver,value:t.Buyer,CusBankName:t.CusBankName,CusBankNo:t.CusBankNo}}))},type:"POST",url:"/Customer/SeachByName"})},appendTo:"#searchAutocomplete",open:function(){var t=$(this).position(),e=t.left,t=t.top+20;$("#searchAutocomplete > ul").css({left:e+"px",top:t+"px"})}}).change(function(){$(this).val()||($("#CusTaxCode").val(""),$("#CusAddress").val(""),$("#CusPhone").val(""),$("#CusCode").val(""),$("#EmailDeliver").val(""),$("#CusName").val()||$("#CusName").val(""),$("#CusBankName").val(""),$("#CusBankNo").val(""))})},this.searchCodeCus=function(){$("#CusCode").autocomplete({focus:function(t,e){},minLength:1,select:function(t,e){$("#CusTaxCode").val(e.item.TaxCode),$("#CusAddress").val(e.item.Address),$("#CusPhone").val(e.item.Phone),$("#CusName").val(e.item.cusname),$("#EmailDeliver").val(e.item.EmailDeliver),$("#CusBankName").val(e.item.CusBankName),$("#CusBankNo").val(e.item.CusBankNo),$("#Buyer").val(e.item.Buyer)},source:function(t,e){$.ajax({data:{searchText:t.term},dataType:"JSON",success:function(t){e($.map(t,function(t){return{id:t.cusid,value:t.Code,TaxCode:t.TaxCode,Address:t.Address,Phone:t.Phone,cusname:t.cusname,EmailDeliver:t.EmailDeliver,Buyer:t.Buyer,CusBankName:t.CusBankName,CusBankNo:t.CusBankNo}}))},type:"POST",url:"/Customer/SeachByCusCode"})},appendTo:"#searchAutocomplete",open:function(){var t=$(this).position(),e=t.left,t=t.top+20;$("#searchAutocomplete > ul").css({left:e+"px",top:t+"px"})}}).change(function(){$(this).val()||($("#CusTaxCode").val(""),$("#CusAddress").val(""),$("#CusPhone").val(""),$("#CusName").val(""),$("#EmailDeliver").val(""),$("#Buyer").val(""),$("#CusBankName").val(""),$("#CusBankNo").val(""))})},$("#DiscountNonTax").change(function(){$("input.amount").eq(0).trigger("change")}),$("#DiscountOther").change(function(){$("#Total").trigger("change")}),$("#Total").change(function(){$("#VATRateItem").trigger("change"),$("#VATRate").trigger("change"),readAfterAmountChanged()}),$("#DiscountAmount").change(function(t){0!=($(this).val()||"0").FormatNumUK()?$(this).parents(".line").eq(0).show().removeClass("hidden"):$(this).parents(".line").eq(0).hide()}),$("#VATAmount").change(function(){readAfterAmountChanged()}),$("#Amount").change(function(){var t=parseInt($("#type").val()||"-9999"),e=(-9999==t&&(t=parseInt($("#INV_TYPE").val()||"-9999")),($(this).val()||"0").FormatNumUK()),a=$("#CurrencyUnit option:selected").val().trim()||"VND";0==e?$("#AmountInWords").val(1..ReadNumber(typeCurrency).replace(/\s\s+/g," ").replace("Một","Không")):(6==t?e<0?$("#AmountInWords").val("Giảm "+Math.abs(e).ReadNumber(a).toLowerCase()):$("#AmountInWords").val("Tăng "+Math.abs(e).ReadNumber(a).toLowerCase()):3==t?(0<e&&$(this).val("-"+$(this).val()),$("#AmountInWords").val("Giảm "+Math.abs(e).ReadNumber(a).toLowerCase())):2==t?$("#AmountInWords").val("Tăng "+Math.abs(e).ReadNumber(a).toLowerCase()):(t=e<0?"Giảm ":"",a=Math.abs(e).ReadNumber($("#CurrencyUnit option:selected").val()).trim(),a=(a=""!=t?t+a.toLowerCase():a)[0].toUpperCase()+a.slice(1),$("#AmountInWords").val(a)),$("#AmountInWords").trigger("change"))}),$("#AmountInWords").change(function(t){$(t.target).val($(t.target).val().replace("  "," ")),$(t.target).trigger("change.Extra10")}),this.bindEvents2Table=function(){$("table.products tbody input").unbind().removeData(),$("table.products tbody").find("input").autocomplete(),$("table.products tbody").find("input").autocomplete("destroy"),formatTagInputNumber(typeCurrency),$("table.products tbody tr").each(function(t,e){var a=$(e).children("td:first");$(a).unbind().click(function(){2<$("table.products tbody tr").length&&confirm("Bạn có chắc chắn muốn xóa dòng sản phẩm này?")&&($(e).remove(),$("table.products tbody tr").each(function(t,e){$(e).children("td:nth-child(2)").text(t+1)}),$("table.products tbody input.amount:first").trigger("change"))})}),onDiscountProductChange(),onSumAmountProduct(),$("table.products input").on("change",function(){$(this).attr("title",$(this).val())}),onSumTotal(),$("table.products tbody .discount").unbind("focusout"),$("table.products tbody .discount").focusout(function(t){var e=$(this).val();""!=e&&$(this).val(e.toFloat().toFixed(2).FormatNumUK2VN())}),onIssumProductChange(),autocompleteProductName("name"),autocompleteProductName("code"),dieuHuong(),onLastRowFous(),bindEvents2Table_over()},this.bindEvents2Table_over=function(){},this.changeVAT=function(){$("#VATRateItem").change(function(){var t=parseInt($(this).val());if(-4==t)console.log("_vatrate -4 return ");else{if(-99===t&&0!=t&&5!=t&&10!=t&&-1!=t&&-2!=t&&8!=t){$("#thueKhacId").show();var e=($("#VATRateF").val()||"-3").FormatNumUK(),e=parseFloat(e);setAmountInWords(e);for(var a=0;a<$(".VATRate").length;a++)$(".VATRate")[a].value=$("#VATRateF").val()}else{$("#thueKhacId").hide(),setAmountInWords(t);for(var n=$("#VATRateItem option:selected").val(),a=0;a<$(".VATRate").length;a++)$(".VATRate")[a].value=n}convertAmount()}})},this.setAmountInWords=function(t){var e=($("#Total").val()||"0").FormatNumUK(),a=0;0<$("#AmountFee").length&&(a=($("#AmountFee").val()||"0").FormatNumUK());var n=e-($("#DiscountNonTax").val()||"0").FormatNumUK(),o=(o=$("#VATRateF").val()||"-3").FormatNumUK();if(totalNumABS=Math.abs(e),0==n)return $("#Amount").attr("value",0),$("#Amount").val(0),$("#VATAmount").val("0"),$("#AmountInWords").val("Không đồng"),n;var r=0,i=0,e=(-99==(t=parseFloat(t))||-3==t?i=e+(r=-3==o?($("#VATAmount").val()||"0").FormatNumUK():parseFloat((n*o/100).toFixed(BteGlobal.ROUND_TOTAL))):0<t?(i=e+(r=parseFloat((n*t/100).toFixed(BteGlobal.ROUND_TOTAL))),BteGlobal.isChiecKhauThuongMai&&(r=-1*Math.abs(r)),$("#VATAmount").val(r.format(0,3,typeCurrency))):($("#VATAmount").val("0"),i=n),i+=Math.abs(a),parseFloat(i.toFixed(BteGlobal.ROUND_TOTAL)));0==e?$("#AmountInWords").val(1..ReadNumber(typeCurrency).replace(/\s\s+/g," ").replace("Một","Không")):(BteGlobal.isChiecKhauThuongMai&&(r=-1*Math.abs(r),e=-1*Math.abs(e)),"6"==$("#INV_TYPE").val()?e<0?$("#AmountInWords").val("Giảm "+Math.abs(e).ReadNumber(typeCurrency).replace(/\s\s+/g," ").toLowerCase()):$("#AmountInWords").val("Tăng "+Math.abs(e).ReadNumber(typeCurrency).replace(/\s\s+/g," ").toLowerCase()):"3"==$("#INV_TYPE").val()||e<0&&"/adjust/createadjustinvwithtoken"==location.pathname.toLowerCase()?$("#AmountInWords").val("Giảm "+Math.abs(e).ReadNumber(typeCurrency).replace(/\s\s+/g," ").toLowerCase()):parseFloat(e)<0?$("#AmountInWords").val("Giảm "+Math.abs(parseFloat(e)).ReadNumber(typeCurrency).replace(/\s\s+/g," ")):$("#AmountInWords").val(parseFloat(e).ReadNumber(typeCurrency).replace(/\s\s+/g," ")),-3!=o&&$("#VATAmount").val(r.format(0,3,typeCurrency)),$("#Amount").val(e.format(0,3,typeCurrency)).attr("value",e.format(0,3,typeCurrency)),setAmountInWords_over(t))},this.setAmountInWords_over=function(t){},this.loadCurrencyUnit=function(){var t=$("#CurrencyUnit").val();"VND"==t?(document.getElementById("divTyGia").style.display="none",document.getElementById("divTongTien").style.display="none"):""!=t&&(document.getElementById("divTyGia").style.display="block",document.getElementById("divTongTien").style.display="block")},this.changeCurrencyUnit=function(){$("#CurrencyUnit").change(function(){"VND"==$(this).val()?($("#ExchangeRate").val(""),$("#ConvertedAmount").val(""),document.getElementById("divTyGia").style.display="none",document.getElementById("divTongTien").style.display="none",BteGlobal.ROUND_TOTAL=0):""!=$(this).val()&&(BteGlobal.ROUND_TOTAL=2,document.getElementById("divTyGia").style.display="block",document.getElementById("divTongTien").style.display="block"),typeCurrency=$(this).val(),formatTagInputNumber($(this).val()),$("#VATRateItem").trigger("change"),$("#moneySymbol")[0].innerHTML=$(this).val()})},this.changeExchangeRate=function(){$("#ExchangeRate").focusout(function(){convertAmount()})},this.convertAmount=function(){var t,e=$("#ExchangeRate").val().FormatNumUK();e?t=parseFloat(e):(t=0,$("#ExchangeRate").val(0)),null!==$("#Amount").val()&&0<=t&&"VND"!=$("#CurrencyUnit").val()&&(e=parseFloat($("#Amount").val().FormatNumUK()),e=parseFloat((e*t).toFixed()),"3"==$("#INV_TYPE").val()&&0<e?$("#ConvertedAmount").val("-"+e.format(0,3,"USD")):$("#ConvertedAmount").val(e.format(0,3,"USD")))},this.formatTagInputNumber=function(t){$("#ConvertedAmount").InitialMoneyUSD(),$("table.products tbody input._number").unbind("focusout"),$("#ExchangeRate").formatOnlyNumber(),$("input.number-negative").each(function(t,e){fnInitialFormatNumber(this)}).ForceNumericOnlyWithNegative().focus(function(){var t=$(this).val();$(this).val(t.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),$("table.products tbody input._number").each(function(t,e){fnInitialFormatNumber(this),BteGlobal.IS_EDIT||BteGlobal.IS_SIGN_REPLACE_TOKEN||BteGlobal.IS_SIGN_ADJSUT_TOKEN||$(this).parents("tr:first").find("input.amount").trigger("change")}).ForceNumericOnly().focus(function(){var t=$(this).val();$(this).val(t.replaceAll(".",""))}).focusout(function(){fnFocusOut(this),BteGlobal.IS_EDIT||BteGlobal.IS_SIGN_REPLACE_TOKEN||BteGlobal.IS_SIGN_ADJSUT_TOKEN||$(this).parents("tr:first").find("input.amount").trigger("change")}),$("table.list-bin-bottom tbody input._number").unbind("focusout"),$(".groupTotal").each(function(t,e){fnInitialFormatNumber(this)}).ForceNumericOnlyWithNegative().focus(function(){var t=$(this).val();$(this).val(t.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)}),formatTagInputNumber_over(t)},this.formatTagInputNumber_over=function(t){},this.fnInitialFormatNumber=function(t){var e=$(t).val();e&&(e=e.replaceAll(".","").replaceAll(",","."),-1<$(t)[0].className.indexOf("quantity")?-1<e.indexOf(".")?$(t).val(parseFloat(e).format(2,3,typeCurrency,!0)):$(t).val(parseFloat(e).format(0,3)):"VND"==typeCurrency?$(t).val(parseFloat(e).format(0,3)):"USD"==typeCurrency&&$(t).val(parseFloat(e).format(2,3,typeCurrency)))},jQuery.event.copy=function(t,e){t=t.jquery?t:jQuery(t),e=e.jquery?e:jQuery(e);var a=t[0].events||jQuery.data(t[0],"events")||jQuery._data(t[0],"events");if(t.length&&e.length&&a)return e.each(function(){for(var t in a)for(var e in a[t])jQuery.event.add(this,t,a[t][e],a[t][e].data)})},this.readAfterAmountChanged=function(){var t=($("#Total").val()||"0").FormatNumUK(),e=($("#DiscountOther").val()||"0").FormatNumUK(),a=($("#AmountFee").val()||"0").FormatNumUK(),n=0,o=0,a=($("#VATAmount").val()&&(n=parseFloat($("#VATAmount").val().FormatNumUK())),0<$("#AmountFee").length&&(a=($("#AmountFee").val()||"0").FormatNumUK()),BteGlobal.IS_DIEU_CHINH_TANG_GIAM?o=t+n+Math.abs(a)-e:(o=Math.abs(t)+Math.abs(n)+Math.abs(a),o-=e,t<0&&(o*=-1)),Math.abs(parseFloat(o)).ReadNumber(typeCurrency).replace(/\s\s+/g," ").toLowerCase());0==o&&(a="Không"+1..ReadNumber(typeCurrency).replace("Một","")),"3"==$("#INV_TYPE").val()?($("#AmountInWords").val("Giảm "+a),o*=-1,e=-1*Math.abs(e)):BteGlobal.IS_DIEU_CHINH_TANG_GIAM?(o<0?$("#AmountInWords").val("Giảm "+a):$("#AmountInWords").val("Tăng "+a),o=t-e+n):(a=Math.abs(o).ReadNumber(typeCurrency).replace(/\s\s+/g," "),o<0?$("#AmountInWords").val("Âm "+a.toLowerCase()):$("#AmountInWords").val(a)),$("#Amount").val(o.format(2,3,typeCurrency)).trigger("change"),readAfterAmountChanged_over()},this.readAfterAmountChanged_over=function(){},$("#hideDiscountOpt").change(function(){if(!CheckDiscountEmpty()&&$("#hideDiscountOpt").prop("checked"))return alert("Xóa số tiền ô giảm trừ để ẩn"),$("#hideDiscountOpt").prop("checked",!1),!1;$("#hideDiscountOpt").prop("checked")?($("#DiscountNonTax").parents(".line").eq(0).hide(),$("#DiscountOther").parents(".line").eq(0).hide()):($("#DiscountNonTax").parents(".line").eq(0).show().removeClass("hidden"),$("#DiscountOther").parents(".line").eq(0).show().removeClass("hidden")),localStorage.setItem(BteGlobal.PATTERN_NUM+"hideDiscountOpt",$("#hideDiscountOpt").prop("checked").toString())});
