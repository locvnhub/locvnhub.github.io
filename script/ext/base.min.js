String.prototype.toFloat=function(){return parseFloat(this.trim())};String.prototype.toInt=function(){return parseInt(this.trim())};String.prototype.dot2Comma=function(){return this.replace(/\./g,",")};String.prototype.comma2dot=function(){return this.replace(/,/g,".")};Number.prototype.ReadNumber=function(typeCurrence){var SoTien=this.valueOf();var _typeCurrence=typeCurrence;var strTienNguyen=SoTien.toString().split(".")[0];var strTienLe=SoTien.toString().split(".")[1];var strDocTienLe="";var lan=0;var i=0;var so=0;var KetQua="";var tmp="";var ViTri=new Array;if(strTienNguyen==0)SoTien=0;if(SoTien<0)return"Số tiền âm !";if(SoTien==0&&strTienLe==0){if(typeCurrence==="USD"){return"Không đô la Mỹ"}else if(typeCurrence==="EUR"){return"Không Euro"}else if(typeCurrence==="CNY"){return"Không CNY"}else{return"Không đồng"}}if(SoTien==0&&strTienLe>0){KetQua=ChuSo[0]}else if(SoTien>0){so=SoTien}else{so=-SoTien}if(SoTien>8999999999999999){return"Sô quá lớn!"}ViTri[5]=Math.floor(so/1e15);if(isNaN(ViTri[5]))ViTri[5]="0";so=so-parseFloat(ViTri[5].toString())*1e15;ViTri[4]=Math.floor(so/1e12);if(isNaN(ViTri[4]))ViTri[4]="0";so=so-parseFloat(ViTri[4].toString())*1e12;ViTri[3]=Math.floor(so/1e9);if(isNaN(ViTri[3]))ViTri[3]="0";so=so-parseFloat(ViTri[3].toString())*1e9;ViTri[2]=parseInt(so/1e6);if(isNaN(ViTri[2]))ViTri[2]="0";ViTri[1]=parseInt(so%1e6/1e3);if(isNaN(ViTri[1]))ViTri[1]="0";ViTri[0]=parseInt(so%1e3);if(isNaN(ViTri[0]))ViTri[0]="0";if(ViTri[5]>0){lan=5}else if(ViTri[4]>0){lan=4}else if(ViTri[3]>0){lan=3}else if(ViTri[2]>0){lan=2}else if(ViTri[1]>0){lan=1}else{lan=0}for(i=lan;i>=0;i--){var isDoc=false;if(ViTri[i].toString().length<3&&i<lan){isDoc=true}tmp=DocSo3ChuSo(ViTri[i],isDoc);isDoc=false;KetQua+=tmp;if(ViTri[i]>0)KetQua+=Tien[i];if(i>0&&tmp.length>0)KetQua+=","}if(KetQua.substring(KetQua.length-1)==","){KetQua=KetQua.substring(0,KetQua.length-1)}if(strTienLe!==undefined&&parseFloat(strTienLe)!==0){strTienLe=strTienLe+"00";strDocTienLe=DocSo3ChuSo(strTienLe.substring(0,2),false);if(_typeCurrence=="VND"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" đồng"}else if(_typeCurrence=="USD"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" đô la Mỹ và "+strDocTienLe+" xu"}else if(_typeCurrence=="EUR"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" euro và "+strDocTienLe+" xu"}else if(_typeCurrence=="CNY"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" tệ và "+strDocTienLe+" hào"}}else{if(_typeCurrence=="VND"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" đồng"}else if(_typeCurrence=="USD"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" đô la Mỹ"}else if(_typeCurrence=="EUR"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" euro"}else if(_typeCurrence=="CNY"){KetQua=KetQua.substring(1,2).toUpperCase()+KetQua.substring(2)+" tệ"}}return KetQua.replace(/\s\s+/g," ")};jQuery.fn.ForceNumericOnly=function(){return this.each(function(){$(this).blur(function(){if($(this).val()=="NaN"){$(this).val(0)}});$(this).keypress(function(e){var className=$(this).attr("class");var keypressed=null;var isDieuChinhAm=$("#INV_TYPE").val()=="3"||$("#INV_TYPE").val()=="4"||$("#INV_TYPE").val()=="6";if(window.event){keypressed=window.event.keyCode;if(className.indexOf("number")>-1||className.indexOf("quantity")>-1){if(keypressed==45&&isDieuChinhAm){return checkDotComma(e.target.value,keypressed)}else if(keypressed<48&&keypressed!=46&&keypressed!=44||keypressed>57&&keypressed!=189){return false}else{return checkDotComma(e.target.value,keypressed)}}}else{keypressed=e.which;if(keypressed===8){return}if(className.indexOf("number")>-1||className.indexOf("quantity")>-1){if(keypressed==45&&isDieuChinhAm){return checkDotComma(e.target.value,keypressed)}else if(keypressed!=46&&keypressed!=44&&keypressed!=45&&isDieuChinhGiamTT||keypressed<48&&keypressed!=46&&keypressed!=44&&isDieuChinhGiamTT||keypressed>57&&keypressed!=189){return false}else{return checkDotComma(e.target.value,keypressed)}}}})})};this.typeCurrency="";var BteGlobal={NEW_ROW_STR:"",ROUND_TOTAL:0,IS_EDIT:location.pathname.toLocaleLowerCase().indexOf("/einvoice/edit")==0,IS_SIGN_REPLACE_TOKEN:location.pathname.toLocaleLowerCase()=="/adjust/createreplaceinvwithtoken",IS_SIGN_ADJSUT_TOKEN:location.pathname.toLocaleLowerCase()=="/adjust/createadjustinvwithtoken",PATTERN_TYPE:"1",IS_DIEU_CHINH_AM:false,IS_DIEU_CHINH_TANG_GIAM:false};$(document).ready(function(){BteGlobal.IS_DIEU_CHINH_AM=$("#INV_TYPE").val()=="3";BteGlobal.IS_DIEU_CHINH_TANG_GIAM=$("#INV_TYPE").val()=="6";cauHinhSoLe();typeCurrency=$("#CurrencyUnit").val();searchCusName();searchCodeCus();bindEvents2Table();changeVAT();$("#CusAddress").keyup(function(){checkTextMaxLength(this)});$("input[type=text]:first").focus();checkTaxCode();$(".formatTaxCode").formatTaxCode();loadCurrencyUnit();changeCurrencyUnit();changeExchangeRate();$("#moneySymbol")[0].innerHTML=typeCurrency;$("#ArisingDate").change(function(){var stringDate1=$("#ArisingDate").val();var d1=Date.parseExact(stringDate1,"d/M/yyyy");if(d1==null&&stringDate1!=null){var VNPT_localization=localStorage.getItem("VNPT_localization");var msg_ErrorDateFormat="Ngày không đúng định dạng";if(VNPT_localization==="en"){msg_ErrorDateFormat="The date is not in the correct format"}alert(msg_ErrorDateFormat);$("#ArisingDate").val($("#defaultArisingDate").val())}});BteGlobal.NEW_ROW_STR=getProductRowStr();BteGlobal.ROUND_TOTAL=$("#CurrencyUnit").val()=="VND"?0:2;BteGlobal.PATTERN_TYPE=$("#patternTypeNum").val();BteGlobal.IS_INV_NO_VAT=$("#patternTypeNum").val()=="2";BteGlobal.PATTERN_NUM=$("#Pattern").val().replace("/","");if(BteGlobal.IS_INV_NO_VAT){$("#VATRateItem").val("-4");$("#VATRate").val("-4")}var exCurrencyUnit=$("#EX_CurrencyUnit").val();if(exCurrencyUnit!=""&&exCurrencyUnit!="VND"&&exCurrencyUnit!=$("#urrencyUnit").val()){$("#CurrencyUnit").val($("#EX_CurrencyUnit").val())}addExtra10();cauHinhThueSuatTOKEN();if(localStorage.getItem(BteGlobal.PATTERN_NUM+"hideDiscountOpt")=="true"){if(CheckDiscountEmpty()==true)$("#hideDiscountOpt").prop("checked",true).trigger(`change`)}});function addExtra10(){if(!document.querySelector("#Extra10")){var addEx10=function(){if(!document.querySelector("#Extra10")){var ex10='<input  class="textr Extra10_ConvertedAmount" title="Đang lưu thẻ Extra10" id="Extra10"  name="Extra10" maxlength="50" type="text" value="0" style="">';$("#ConvertedAmount").after(ex10);$(".Extra10_ConvertedAmount").on("change.Extra10",function(){$("#ConvertedAmount").val($("#Extra10").val());$("#ConvertedAmount").attr("value",$("#Extra10").val())})}$("#ConvertedAmount").hide();if($("#ConvertedAmount").val()!=""&&$("#ConvertedAmount").val().FormatNumUK()!=0){$("#Extra10").val($("#ConvertedAmount").val())}};if($("#CurrencyUnit").val()!="VND"){addEx10()}$("#CurrencyUnit").on("change.Extra10",function(){if($(this).val()=="VND"){$(".Extra10_ConvertedAmount").remove();return}addEx10()});$("#AmountInWords , #ExchangeRate").on("change.Extra10",function(evt){if($("#CurrencyUnit").val()!="VND"){$("#Extra10").val($("#ConvertedAmount").val());$("#Extra10").attr("value",$("#ConvertedAmount").val());$(".Extra10_ConvertedAmount").trigger("change.Extra10")}else{$(".Extra10_ConvertedAmount").remove()}});$('input[type="submit"]').on("mousedown",function(){var val2=$(".Extra10_ConvertedAmount").val()||"";$(".Extra10_ConvertedAmount").val(val2.FormatNumUK())})}}function cauHinhThueSuatTOKEN(){var AmountNT=parseInt($("#Amount").val().replace(",","").replace(".",""));if(AmountNT==0){return}var isReplace=location.pathname.toLocaleLowerCase()=="/adjust/createreplaceinvwithtoken";var isAjust=location.pathname.toLocaleLowerCase()=="/adjust/createadjustinvwithtoken";if(isAjust||isReplace){$("#VATRateItem").val($("#EX_VATRate").val()).trigger("change");$("#VATAmount").val($("#VATAmount").attr("value"));$("#Amount").val($("#Amount").attr("value"))}}function SumAmountProduct(){vTotal=0;vDiscountAmount=0;$("table.products tbody .amount").each(function(i,pAmount){var isum=$(pAmount).parents("tr").eq(0).find(".Issum").val();var amountNum=($(pAmount).val()||"0").FormatNumUK();vDiscountAmount+=($(pAmount).parent().parent().find(".discountamount").val()||"0").FormatNumUK();if(isum==0){vTotal+=($(pAmount).val()||"0").FormatNumUK()}else if(isum==2){vTotal-=($(pAmount).val()||"0").FormatNumUK();vDiscountAmount+=amountNum}});return{Total:vTotal,DiscountAmount:vDiscountAmount}}function getListProductStringExtra(_product,row){var getExtra1=$("table.products th.Extra1TH").length>0?$("table.products th.Extra1TH").attr("class").indexOf("hide")==-1:false;var getExtra2=$("table.products th.Extra2TH").length>0?$("table.products th.Extra2TH").attr("class").indexOf("hide")==-1:false;var getRemark=$("table.products th.RemarkTH").length>0?$("table.products th.RemarkTH").attr("class").indexOf("hide")==-1:false;if(getExtra1){var ex1=$(row).find("input.extra1");_product.Extra1=ex1.val();if((ex1.attr("class").indexOf("_number")>-1||ex1.attr("class").indexOf("number-negative")>-1)&&_product.Extra1!=""){_product.Extra1=_product.Extra1.FormatNumUK()}}if(getExtra2){var ex2=$(row).find("input.extra2");_product.Extra2=ex2.val();if((ex2.attr("class").indexOf("_number")>-1||ex2.attr("class").indexOf("number-negative")>-1)&&_product.Extra2!=""){_product.Extra2=_product.Extra2.FormatNumUK()}}if(getRemark){var ex3=$(row).find("input.remark");_product.Remark=ex3.val();if((ex3.attr("class").indexOf("_number")||ex3.attr("class").indexOf("number-negative")>-1)&&_product.Remark!=""){_product.Remark=_product.Remark.FormatNumUK()}}}function getListProductString(){var productList=[];var check=0;var discountAmount=0;$("table.products tbody tr").each(function(i,row){var _product={};var _pName=$(row).find("input[type=text].name");if(_pName.length==0){_pName=$(row).find("textarea.name")}if(_pName.val().trim()==""){return}var _pUnit=$(row).find("input[type=text].unit");var _pQuantity=$(row).find("input[type=text].quantity");var _pPrice=$(row).find("input[type=text].price");var _pDiscount=$(row).find("input[type=text].discount");var _pDiscountAmount=$(row).find("input[type=text].discountamount");var _pAmount=$(row).find("input[type=text].amount");var _pIsSum=$(row).find(":selected:first");var _VATRate=$(row).find("input.VATRate:first");var _code=$(row).find("input[type=text].code:first");if(_pAmount.val()||_pName.val()){_product.ProdType=1;_product.Name=_pName.val()||"";_product.Unit=_pUnit.val()||"";_product.Quantity=_pQuantity.val()||0;_product.Price=_pPrice.val()||0;_product.Discount=_pDiscount.val()||"0";_product.DiscountAmount=_pDiscountAmount.val()||"0";_product.Total=_pAmount.val()||"0";_product.IsSum=_pIsSum.val()||0;_product.Name=_product.Name.replace(/\n/gim," ").trim();if($("#VATRate").val()=="-4"){_product.VATRate=-4}else{_product.VATRate=_VATRate.val()}if(_product.Total!=""){_product.Total=_product.Total.replaceAll(".","")}_product.Code=(_code.val()||"").trim();discountAmount+=(_pDiscountAmount.val()||"0").FormatNumUK()||0;if(parseFloat(_product.VATRate)<0){_product.VATAmount=0}else{_product.VATAmount=(parseFloat(_product.VATRate)*parseFloat(_product.Total.FormatNumUK())/100).toFixed(BteGlobal.ROUND_TOTAL)}_product.Amount=(parseFloat(_product.VATAmount)+parseFloat(_product.Total.FormatNumUK())).toFixed(BteGlobal.ROUND_TOTAL);if(parseFloat(_product.Amount)<0&&$("#INV_TYPE").val()!="3"){_product.Amount=_product.Amount*-1}if(_product.Amount!=""&&_product.Name.trim()==""){check=0;_products.length=0;return false}if(_product.Amount.toString().length>18||_product.Amount.toString().indexOf("e")>=0||_product.Price>0&&(_product.Price.toString().length>18||_product.Price.toString().indexOf("e")>=0)||_product.Quantity>0&&(_product.Quantity.toString().length>18||_product.Quantity.toString().indexOf("e")>=0)){check=1;_products.length=0;return false}var discountValue=_product.Discount.FormatNumUK();if(discountValue>100){check=2;_products.length=0;return false}if(parseFloat(_product.VATAmount)!=0){_product.VATAmount=_product.VATAmount.toString().FormatNumUK2VN()}if(parseFloat(_product.Amount)!=0){_product.Amount=_product.Amount.toString().FormatNumUK2VN()}getListProductStringExtra(_product,row);productList.push(_product)}});return{productList:productList,check:check,discountAmount:discountAmount}}function showExtraProcut(ExtraName){$("table.products th."+ExtraName+"TH").removeClass("hide");$("table.products td.col-"+ExtraName).removeClass("hide")}function getProductRowStr(){var htm=$("table.products tbody tr:last").html().trim();return"<tr>"+htm+"</tr>"}function apendLastRow(strRow){var len1=$("table.products tbody tr").length-1;var stt1=$("table.products tbody tr").eq(len1).find("td").eq(1).text().trim();$("table.products tbody").append(strRow);var lastR=$("table.products tbody tr:last");if(stt1.trim()!=""&&!isNaN(parseInt(stt1))){stt1=parseInt(stt1)+1;lastR.find("td").eq(1).text(stt1.toString())}else{stt1=1;lastR.find("td").eq(1).text("")}lastR.find("#IsSum").val(0);lastR.find("input").each(function(x,y){if($(y).attr("class")&&$(y).attr("class").indexOf("VATRate")>-1){return}$(y).val("")})}$("#btnAddRow").on("click",function(){apendLastRow(BteGlobal.NEW_ROW_STR);bindEvents2Table()});this.dieuHuong=function(){$("table.products tbody input").bind("keydown.nav",function(e){var _post=0;if(!$(this).is(":checkbox")){_post=this.selectionStart}var _start=0,_end=$(this).val().length;var _cindex=$(this).parents("td:first").index();var _rindex=$(this).parents("tr:first").index();if(e.which==13||e.keyCode==13){return false}if(!$(this).data("autocomplete_on")){switch(e.which||e.keyCode){case 37:if($(this).is(":checkbox")||!$(this).val()||!$(this).is(":checkbox")&&_post<=_start){var _leftrow=$("table.products tbody").children("tr:nth-child("+(_rindex+1)+")");var _leftcol=$(_leftrow).children("td:nth-child("+_cindex+")");var _cellfocus=_leftcol.children("input:first").focus();if(_cellfocus.length>0){$(this).trigger("change").trigger("blur")}return false}break;case 38:var _uprow=$("table.products tbody").children("tr:nth-child("+_rindex+")");var _upcol=$(_uprow).children("td:nth-child("+(_cindex+1)+")");var _cellfocus=_upcol.children("input:first").focus();if(_cellfocus.length>0){$(this).trigger("change").trigger("blur")}return false;break;case 39:if($(this).is(":checkbox")||!$(this).val()||!$(this).is(":checkbox")&&_post>=_end){var _rightrow=$("table.products tbody").children("tr:nth-child("+(_rindex+1)+")");var _rightcol=$(_rightrow).children("td:nth-child("+(_cindex+2)+")");var _cellfocus=_rightcol.children("input:first").focus();if(_cellfocus.length>0){$(this).trigger("change").trigger("blur")}return false}break;case 40:var _downrow=$("table.products tbody").children("tr:nth-child("+(_rindex+2)+")");var _downcol=$(_downrow).children("td:nth-child("+(_cindex+1)+")");var _cellfocus=_downcol.children("input:first").focus();if(_cellfocus.length>0){$(this).trigger("change").trigger("blur")}return false;break}}})};this.checkTaxCode=function(){$("#CusTaxCode").blur(function(){var _this=$(this);$("#errorTaxCode").remove();if(_this.val()){$.ajax({type:"POST",url:"/Company/checkMST/",data:{mst:$(this).val()},success:function(data){if(!data){_this.addClass("error").parent(".control").append('<label id="errorTaxCode" for="CusTaxCode" generated="true" class="error">Mã số thuế không hợp lệ</label>')}else{_this.removeClass("error");$("#CusAddress").addClass("required");$("#lbCusAddress").addClass("imp")}}})}else{_this.removeClass("error");$("#CusAddress").removeClass("required");$("#lbCusAddress").removeClass("imp")}})};function checkMstCusName(){if($("#CusTaxCode").val()!=""&&$("#CusName").val().trim()==""){alert('Bắt buộc nhập "Tên đơn vị mua hàng" nếu có nhập Mã số thuế Khách hàng');return false}return true}function checkCusNameBuyer(){if($("#Buyer").val().trim()==""&&$("#CusName").val().trim()==""){alert("Hóa đơn chưa nhập Tên đơn vị hoặc Người mua hàng");return false}return true}this.submit=function(){if(!checkMstCusName())return false;var VNPT_localization=localStorage.getItem("VNPT_localization");submit_over_begin();var check=0;$("#VatAmount0").val("0");$("#VatAmount5").val("0");$("#VatAmount10").val("0");$("#GrossValue").val("0");$("#GrossValue0").val("0");$("#GrossValue5").val("0");$("#GrossValue10").val("0");$("#GrossValueNonTax").val("0");$("#VATAMOUNTOTHER").val("0");$("#GROSSVALUEOTHER").val("0");$("#VatAmount8").val("0");$("#GrossValue8").val("0");var _totalamount=$("#Total").val().FormatNumUK();var _vatamount=$("#VATAmount").val().FormatNumUK();var _vatrate=$("#VATRateItem").val().toFloat();var _VATRateF=$("#VATRateF").val();if(_vatrate==-99&&_VATRateF!=""){_VATRateF=_VATRateF.FormatNumUK();if([0,5,8,10,-1,-2].indexOf(_VATRateF)>-1){$("#VATRateItem").val(_VATRateF);$("#VATRateF").val("");_vatrate=_VATRateF}}if(BteGlobal.IS_INV_NO_VAT){_vatrate=-4}if(_vatrate>0){if(_vatrate==10){$("#VatAmount10").val(_vatamount.toString().replaceAll(".",","));$("#GrossValue10").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}else if(_vatrate==5){$("#VatAmount5").val(_vatamount.toString().replaceAll(".",","));$("#GrossValue5").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}else if(_vatrate==8){$("#VatAmount8").val(_vatamount.toString().replaceAll(".",","));$("#GrossValue8").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}}else if(_vatrate==-99){var tempRATE=$("#VATRateF").val();if($("#VATRateF").val()==""||$("#VATRateF").val()==null){tempRATE=-3;$("#VATRateF").val(tempRATE);$("table.products .VATRate").val(tempRATE)}_vatrate=parseFloat(tempRATE||"0");$("#VATAMOUNTOTHER").val(_vatamount.toString().replaceAll(".",","));$("#GROSSVALUEOTHER").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val($("#VATRateF").val())}else{if(_vatrate==-1){$("#GrossValue").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}else if(_vatrate==0){$("#VatAmount0").val("0");$("#GrossValue0").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}else if(_vatrate==-2){$("#GrossValueNonTax").val(_totalamount.toString().replaceAll(".",","));$("#VATRate").val(_vatrate)}}if($("#errorTaxCode").length>0){$("#errorTaxCode").show();$("#CusTaxCode").addClass("error");var msg_CusTaxCodeError="Xin lỗi, mã số thuế của khách hàng không chuẩn.\n- Bạn có muốn tiếp tục lưu hóa đơn không?";if(VNPT_localization==="en"){msg_CusTaxCodeError="Sorry, The Customer's Tax Code Is Not Correct. \n- Do You Want To Continue To Save The Invoice?"}if(!confirm(msg_CusTaxCodeError)){return false}}if($("#Total").val().indexOf("-")>=0&&$("#INV_TYPE").val()!="3"&&$("#INV_TYPE").val()!="6"){var msg_TotalAmountNegative="Xin lỗi, hóa đơn có giá trị âm [Tổng tiền hóa đơn], chưa thể phát sinh giao dịch.";if(VNPT_localization==="en"){msg_TotalAmountNegative="Sorry, The Invoice Has A Negative Value [amount Invoice], No Transactions Yet."}alert(msg_TotalAmountNegative);return false}if($("#Total").val().FormatNumUK()>=2e7&&$("#PaymentMethod").val()!="CK"){var mesageconfirm="Số tiền quá lớn, bạn nên thanh toán chuyển khoản.\n- Bạn có muốn tiếp tục lưu hóa đơn không?";if(VNPT_localization==="en"){mesageconfirm="The Amount Is Too Large, You Should Pay For The Transfer. \n- Do You Want To Continue To Save The Invoice?"}if(!confirm(mesageconfirm)){return false}}var type=$("#INV_TYPE").val();var amount=$("#Amount").val().FormatNumUK();var oldAmount=$("#OldAmount").val();if("3"==type&&oldAmount>0){oldAmount=oldAmount.FormatNumUK();if(amount>=oldAmount){var mesageconfirm="Bạn đang lập hóa đơn điều chỉnh giảm quá 100% chi tiết hàng hóa trong hóa đơn gốc.\n- Bạn có muốn tiếp tục lưu hóa đơn không?";if(!confirm(mesageconfirm)){return false}}}var vatAmountLst=["VatAmount0","VatAmount5","VatAmount10","GrossValue","GrossValue0","GrossValue5","GrossValue10","GrossValueNonTax","VATAMOUNTOTHER","GROSSVALUEOTHER","VatAmount8","GrossValue8"];if($("#INV_TYPE").val()=="3"){vatAmountLst.forEach(function(x){var val=$("#"+x).val();if(val&&val.FormatNumUK()>0){$("#"+x).val("-"+val)}})}var _discountAmount=0;var _products=[];var temp1=getListProductString();_products=temp1.productList;check=temp1.check;_discountAmount=0;if(_products.length==0){if(check==0){var msg_HaveNotDataProducts="Xin lỗi, danh sách sản phẩm chưa có hoặc thông tin sản phẩm bị thiếu!";if(VNPT_localization==="en"){msg_HaveNotDataProducts="Sorry, Product Listings Are Unavailable, Or Product Information Is Missing!"}alert(msg_HaveNotDataProducts)}else if(check==1){var msg_DataProductContainsProductThanValueAccepted="Xin lỗi, danh sách sản phẩm có chứa sản phẩm vượt quá giá trị cho phép của hóa đơn!";if(VNPT_localization==="en"){msg_DataProductContainsProductThanValueAccepted="Sorry, The Product List Contains Products That Exceed The Allowed Value Of The Invoice"}alert(msg_DataProductContainsProductThanValueAccepted)}else{var msg_ProductAmountInvalid="Xin lỗi, danh sách sản phẩm có chứa sản phẩm vượt quá giá trị chiết khấu cho phép!";if(VNPT_localization==="en"){msg_ProductAmountInvalid="Sorry, The product list contains products that exceed the allowed discount value"}alert(msg_ProductAmountInvalid)}return false}_products=submitProducts_ext(_products);$("#PubDatasource").val(JSON.stringify(_products));var today=new Date;var dd=String(today.getDate()).padStart(2,"0");var mm=String(today.getMonth()+1).padStart(2,"0");var yyyy=today.getFullYear();var todayStr=dd+"/"+mm+"/"+yyyy;if($("#dateTimeClient").val()!=undefined){$("#dateTimeClient").val(todayStr)}var isArisingDate=parseInt($("#isArisingDate").val()||"0");if($("#ArisingDate").val()==""&&isArisingDate==1){$("#ArisingDate").val(todayStr);$("#defaultArisingDate").val(todayStr)}else if($("#ArisingDate").val()==""&&isArisingDate==0){$("#ArisingDate").attr("name","ArisingDate_remove");$("#defaultArisingDate").attr("name","defaultArisingDate_remove")}if($("#ArisingDate").val()!=""&&isArisingDate==0){$("#isArisingDate").val(1)}$("input[type=text]._number").each(function(i,item){var _val=$(this).val();$(this).val(_val.replaceAll(".",""))});$("input[type=text].number-negative").each(function(i,item){var _val=$(this).val();$(this).val(_val.replaceAll(".",""))});if(submit_over()==false){return false}return true};function submitProducts_ext(_products){return _products}function submit_over_begin(){}function submit_over(){return true}this.searchCusName=function(){$("#CusName").autocomplete({focus:function(event,ui){},minLength:1,select:function(event,ui){$("#CusTaxCode").val(ui.item.TaxCode);$("#CusAddress").val(ui.item.Address);$("#CusPhone").val(ui.item.Phone);$("#CusCode").val(ui.item.Code);$("#EmailDeliver").val(ui.item.EmailDeliver);$("#CusBankName").val(ui.item.CusBankName);$("#CusBankNo").val(ui.item.CusBankNo);$("#Buyer").val(ui.item.Buyer)},source:function(request,response){$.ajax({data:{searchText:request.term},dataType:"JSON",success:function(data){response($.map(data,function(item){if(item.cusname!=null&&item.cusname!=""){return{id:item.cusid,value:item.cusname,TaxCode:item.TaxCode,Address:item.Address,Phone:item.Phone,Code:item.Code,EmailDeliver:item.EmailDeliver,Buyer:item.Buyer,CusBankName:item.CusBankName,CusBankNo:item.CusBankNo}}}))},type:"POST",url:"/Customer/SeachByName"})},appendTo:"#searchAutocomplete",open:function(){var position=$(this).position(),left=position.left,top=position.top+20;$("#searchAutocomplete > ul").css({left:left+"px",top:top+"px"})}}).change(function(){if(!$(this).val()){$("#CusTaxCode").val("");$("#CusAddress").val("");$("#CusPhone").val("");$("#CusCode").val("");$("#EmailDeliver").val("");if(!$("#Buyer").val()){$("#Buyer").val("")}$("#CusBankName").val("");$("#CusBankNo").val("")}});$("#Buyer").autocomplete({focus:function(event,ui){},minLength:1,select:function(event,ui){$("#CusTaxCode").val(ui.item.TaxCode);$("#CusAddress").val(ui.item.Address);$("#CusPhone").val(ui.item.Phone);$("#CusCode").val(ui.item.Code);$("#EmailDeliver").val(ui.item.EmailDeliver);$("#CusBankName").val(ui.item.CusBankName);$("#CusBankNo").val(ui.item.CusBankNo);$("#CusName").val(ui.item.cusname)},source:function(request,response){$.ajax({data:{searchText:request.term},dataType:"JSON",success:function(data){response($.map(data,function(item){if(item.Buyer!=null&&item.Buyer!=""){return{id:item.cusid,cusname:item.cusname,TaxCode:item.TaxCode,Address:item.Address,Phone:item.Phone,Code:item.Code,EmailDeliver:item.EmailDeliver,value:item.Buyer,CusBankName:item.CusBankName,CusBankNo:item.CusBankNo}}}))},type:"POST",url:"/Customer/SeachByName"})},appendTo:"#searchAutocomplete",open:function(){var position=$(this).position(),left=position.left,top=position.top+20;$("#searchAutocomplete > ul").css({left:left+"px",top:top+"px"})}}).change(function(){if(!$(this).val()){$("#CusTaxCode").val("");$("#CusAddress").val("");$("#CusPhone").val("");$("#CusCode").val("");$("#EmailDeliver").val("");if(!$("#CusName").val()){$("#CusName").val("")}$("#CusBankName").val("");$("#CusBankNo").val("")}})};this.searchCodeCus=function(){$("#CusCode").autocomplete({focus:function(event,ui){},minLength:1,select:function(event,ui){$("#CusTaxCode").val(ui.item.TaxCode);$("#CusAddress").val(ui.item.Address);$("#CusPhone").val(ui.item.Phone);$("#CusName").val(ui.item.cusname);$("#EmailDeliver").val(ui.item.EmailDeliver);$("#CusBankName").val(ui.item.CusBankName);$("#CusBankNo").val(ui.item.CusBankNo);$("#Buyer").val(ui.item.Buyer)},source:function(request,response){$.ajax({data:{searchText:request.term},dataType:"JSON",success:function(data){response($.map(data,function(item){return{id:item.cusid,value:item.Code,TaxCode:item.TaxCode,Address:item.Address,Phone:item.Phone,cusname:item.cusname,EmailDeliver:item.EmailDeliver,Buyer:item.Buyer,CusBankName:item.CusBankName,CusBankNo:item.CusBankNo}}))},type:"POST",url:"/Customer/SeachByCusCode"})},appendTo:"#searchAutocomplete",open:function(){var position=$(this).position(),left=position.left,top=position.top+20;$("#searchAutocomplete > ul").css({left:left+"px",top:top+"px"})}}).change(function(){if(!$(this).val()){$("#CusTaxCode").val("");$("#CusAddress").val("");$("#CusPhone").val("");$("#CusName").val("");$("#EmailDeliver").val("");$("#Buyer").val("");$("#CusBankName").val("");$("#CusBankNo").val("")}})};function onLastRowFous(){$("table.products tbody input:text").change(function(){var _this=$(this);var _rowsc=_this.parents("tbody").children("tr").length;if(_this.parents("tr:first").children("td:nth-child(2)").text()==_rowsc){var _addable=false;_this.parents("tr:first").find("input:text").each(function(i,item){if($(item).val()){_addable=true}});if(_addable){apendLastRow(BteGlobal.NEW_ROW_STR);bindEvents2Table()}}})}function autocompleteProductName(codeOrName){codeOrName=codeOrName||"name";var pathURL=codeOrName=="name"?"Name":"Code";$("table.products tbody input."+codeOrName).data("autocomplete_on",false).bind("autocompleteopen",function(event,ui){$(this).data("autocomplete_on",true)}).bind("autocompleteclose",function(event,ui){$(this).data("autocomplete_on",false)}).autocomplete({source:function(request,response){console.log("request.term",request);$.ajax({type:"POST",url:"/Product/SeachBy"+pathURL,dataType:"JSON",data:{searchText:request.term},success:function(data){if(data===null){if(codeOrName=="name")$(this).parents("tr:first").find("input.Code").val("");else $(this).parents("tr:first").find("input.Name").val("")}var data2=[];if(codeOrName=="code"){data2=data2.concat(data.filter(x=>x.Code.indexOf(request.term)==0).slice(0,5)).concat(data.filter(x=>x.Code.indexOf(request.term)==1).slice(0,3)).concat(data.filter(x=>x.Code.indexOf(request.term)==3).slice(0,3)).concat(data.filter(x=>x.Code.indexOf(request.term)>1).slice(0,5))}else{data2=data2.concat(data.filter(x=>x.Name.indexOf(request.term)==0).slice(0,5)).concat(data.filter(x=>x.Name.indexOf(request.term)==1).slice(0,3)).concat(data.filter(x=>x.Name.indexOf(request.term)==3).slice(0,3)).concat(data.filter(x=>x.Name.indexOf(request.term)>0).slice(0,5))}response($.map(data2,function(item){return{label:item.Code+" | "+item.Name,Name:item.Name,Unit:item.Unit,Price:item.Price,Code:item.Code}}))}})},minLength:1,select:function(event,ui){$(this).parents("tr:first").find("input.unit").val(ui.item.Unit);if(codeOrName=="name"){$(this).parents("tr:first").find("input.code").val(ui.item.Code)}else{$(this).parents("tr:first").find("input.name").val(ui.item.Name)}$(this).parents("tr:first").find("input.price").val(ui.item.Price.toString().replace(".",",")).trigger("focusout");if(event.which!=9||event.keyCode!=9){$(this).parents("tr:first").find("input.quantity").focus()}else{$(this).parents("tr:first").find("input.unit").focus()}$(this).val(ui.item[pathURL]).trigger("change");return false},appendTo:"#searchAutocomplete",open:function(){var position=$(this).position(),left=position.left,top=position.top+20;$("#searchAutocomplete > ul").css({left:left+"px",top:top+"px"})}})}function onSumAmountProduct(){$(`table.products tbody .quantity 
          , table.products tbody .price
          , table.products tbody .discountamount
          ,table.products tbody .Issum`).change(function(evt){var FOMULAR=$("#TotalFomular").val()||1;if(FOMULAR==2&&$(evt.target).attr("class").indexOf("price")>-1){return}if(FOMULAR==3&&$(evt.target).attr("class").indexOf("quantity")>-1){return}const T_ROW=$(this).parents("tr:first");var priceN=(T_ROW.find("input.price").val()||"0").FormatNumUK();priceN=Math.abs(priceN);var quantityN=(T_ROW.find("input.quantity").val()||"0").FormatNumUK();var totalRoundConfig=$("#totalRound").val();var discountAmount=(T_ROW.find("input.discountamount").val()||"0").FormatNumUK();if(FOMULAR==3){var amountNum=T_ROW.find("input.amount").val().FormatNumUK()||0;if(priceN!=0){quantityN=amountNum/priceN;T_ROW.find("input.quantity").attr("value",quantityN.toFixed(totalRoundConfig));T_ROW.find("input.quantity").val(quantityN.toFixed(totalRoundConfig).toFloat().format(0,3,typeCurrency))}}else if(FOMULAR==2){var amountNum=T_ROW.find("input.amount").val().FormatNumUK()||0;if(quantityN!=0){priceN=amountNum/quantityN;T_ROW.find("input.price").attr("value",priceN.toFixed(totalRoundConfig));T_ROW.find("input.price").val(priceN.toFixed(totalRoundConfig).toFloat().format(0,3,typeCurrency))}}else{var amountNum=quantityN*priceN-discountAmount;T_ROW.find("input.amount").attr("title",amountNum.toString());if(priceN!=0||quantityN!=0){if($("#INV_TYPE").val()=="3"){amountNum=Math.abs(amountNum)*-1}var amountF=amountNum.toFixed(totalRoundConfig).toFloat().format(0,3,typeCurrency);T_ROW.find("input.amount").val(amountF).trigger("change")}else{T_ROW.find("input.amount").val(0).trigger("change")}}onSumAmountProduct_ext()});onSumAmountProduct_over()}function onSumAmountProduct_ext(){}function onSumAmountProduct_over(){}function onDiscountProductChange(){$(`table.products tbody .discount`).change(function(){const T_ROW=$(this).parents("tr:first");var proName=T_ROW.find("input.name").val();var priceN=T_ROW.find("input.price").val().FormatNumUK()||0;var quantityN=T_ROW.find("input.quantity").val().FormatNumUK()||0;var discountRate=T_ROW.find("input.discount").val().FormatNumUK()||0;var discountAmount=priceN*quantityN*discountRate/100;if(discountAmount>0){T_ROW.find("input.discountamount").val(discountAmount.toFixed($("#totalRound").val()).toString().FormatNumUK2VN()).trigger("change")}else if(proName!=""){T_ROW.find("input.discountamount").val(0).trigger("change")}else{T_ROW.find("input.discountamount").val("").trigger("change")}});onDiscountProductChange_over()}function onDiscountProductChange_over(){}function onIssumProductChange(){$(`table.products tbody .Issum`).change(function(evt){var RowC=$(this).parents("tr");if($(this).val()=="2"){RowC.find(".discount").val("");RowC.find(".discountamount").val("");RowC.find(".discount").attr("disabled","disabled");RowC.find(".discountamount").attr("disabled","disabled")}else{RowC.find(".discount").attr("disabled",false);RowC.find(".discountamount").attr("disabled",false)}})}function onSumTotal(){$(`table.products tbody .amount,
        table.products tbody .Issum`).change(function(evt){var vTotal=0;var vDiscountAmount=0;var INV_TYPE=$("#INV_TYPE").val()||"0";var amountT=($(evt.target).parents("tr").find(".amount").val()||"0").FormatNumUK();if(INV_TYPE=="3"&&amountT.toString().indexOf("-")==-1&&amountT>0){$(evt.target).parents("tr").find(".amount").val("-"+amountT.format(0,3,typeCurrency))}d=SumAmountProduct();vTotal=d.Total;vDiscountAmount=d.DiscountAmount;if($("#TotalFomular").val()==2){var curRow=$(evt.target).closest("tr");curRow.find(".quantity").trigger(`change`)}else if($("#TotalFomular").val()==3){var curRow=$(evt.target).parents("tr").eq(0);curRow.find(".price").trigger(`change`)}$("#Total").val(vTotal.toFixed(BteGlobal.ROUND_TOTAL).toFloat().format(0,3,typeCurrency)).trigger(`change`);$("#DiscountAmount").val(vDiscountAmount.toFixed().toFloat().format(0,3,typeCurrency)).trigger(`change`);onSumTotal_ext()});onSumTotal_over()}function onSumTotal_ext(){}function onSumTotal_over(){}$("#DiscountNonTax").change(function(){$("input.amount").eq(0).trigger(`change`)});$("#DiscountOther").change(function(){$("input.amount").eq(0).trigger(`change`)});$("#Total").change(function(){$("#VATRateItem").trigger(`change`);$("#VATRate").trigger(`change`);readAfterAmountChanged()});$("#DiscountAmount").change(function(evt){var v=($(this).val()||"0").FormatNumUK();if(v!=0){$(this).parents(".line").eq(0).show().removeClass("hidden")}else{$(this).parents(".line").eq(0).hide()}});$("#VATAmount").change(function(){readAfterAmountChanged()});$("#Amount").change(function(){var _amountVal=($(this).val()||"0").FormatNumUK();var CurrencyUnit=$("#CurrencyUnit option:selected").val().trim();if($("#INV_TYPE").val()=="3"){if(_amountVal>0)$(this).val("-"+$(this).val());$("#AmountInWords").val("Giảm "+Math.abs(_amountVal).ReadNumber(CurrencyUnit).toLowerCase())}else if($("#INV_TYPE").val()=="6"){if(_amountVal>0){$("#AmountInWords").val("Tăng "+Math.abs(_amountVal).ReadNumber(CurrencyUnit).toLowerCase())}else{$("#AmountInWords").val("Giảm "+Math.abs(_amountVal).ReadNumber(CurrencyUnit).toLowerCase())}}else{var word=_amountVal.ReadNumber(CurrencyUnit).trim();if(word[0])word=word[0].toUpperCase()+word.slice(1);$("#AmountInWords").val(word)}$("#AmountInWords").trigger("change")});$("#AmountInWords").change(function(evt){$(evt.target).val($(evt.target).val().replace("  "," "));$(evt.target).trigger("change.Extra10")});this.bindEvents2Table=function(){$("table.products tbody input").unbind().removeData();$("table.products tbody").find("input").autocomplete();$("table.products tbody").find("input").autocomplete("destroy");formatTagInputNumber(typeCurrency);$("table.products tbody tr").each(function(i,row){var _del=$(row).children("td:first");$(_del).unbind().click(function(){if($("table.products tbody tr").length>2){if(confirm("Bạn có chắc chắn muốn xóa dòng sản phẩm này?")){$(row).remove();$("table.products tbody tr").each(function(ii,rr){$(rr).children("td:nth-child(2)").text(ii+1)});$("table.products tbody input.amount:first").trigger("change")}}})});onDiscountProductChange();onSumAmountProduct();$("table.products input").on("change",function(){$(this).attr("title",$(this).val())});onSumTotal();$("table.products tbody .discount").unbind("focusout");$("table.products tbody .discount").focusout(function(evt){var v=$(this).val();if(v!=""){$(this).val(v.toFloat().toFixed(2).FormatNumUK2VN())}});onIssumProductChange();autocompleteProductName("name");autocompleteProductName("code");dieuHuong();onLastRowFous();bindEvents2Table_over()};this.bindEvents2Table_over=function(){};this.changeVAT=function(){$("#VATRateItem").change(function(){var _vatrate=parseInt($(this).val());if(_vatrate==-4){console.log(`_vatrate -4 return `);return}if(_vatrate===-99&&_vatrate!=0&&_vatrate!=5&&_vatrate!=10&&_vatrate!=-1&&_vatrate!=-2&&_vatrate!=8){$("#thueKhacId").show();var vatRateFValue=($("#VATRateF").val()||"-3").FormatNumUK();var _vatrateF=parseFloat(vatRateFValue);setAmountInWords(_vatrateF);for(var i=0;i<$(".VATRate").length;i++){$(".VATRate")[i].value=$("#VATRateF").val()}}else{$("#thueKhacId").hide();setAmountInWords(_vatrate);var vatRate=$("#VATRateItem option:selected").val();for(var i=0;i<$(".VATRate").length;i++){$(".VATRate")[i].value=vatRate}}convertAmount()})};this.setAmountInWords=function(_vatrate){var totalNum=$("#Total").val()||"0";var vDiscountNonTax=($("#DiscountNonTax").val()||"0").FormatNumUK();var VATkhac=$("#VATRateF").val()||"-3";VATkhac=VATkhac.FormatNumUK();totalNum=totalNum.FormatNumUK();totalNumABS=Math.abs(totalNum);if(totalNum==0){$("#Amount").val(0).attr("value",0);$("#VATAmount").val("0");$("#AmountInWords").val("Không đồng");return totalNum}var _vatamount=0;var _amount=0;_vatrate=parseFloat(_vatrate);if(_vatrate==-99||_vatrate==-3){if(VATkhac==-3){_vatamount=($("#VATAmount").val()||"0").FormatNumUK()}else{_vatamount=parseFloat(((totalNum-vDiscountNonTax)*VATkhac/100).toFixed(BteGlobal.ROUND_TOTAL))}_amount=totalNum+_vatamount}else if(_vatrate>0){_vatamount=parseFloat(((totalNum-vDiscountNonTax)*_vatrate/100).toFixed(BteGlobal.ROUND_TOTAL));_amount=totalNum+_vatamount;$("#VATAmount").val(_vatamount.format(0,3,typeCurrency))}else{$("#VATAmount").val("0");_amount=totalNum}var amountF=parseFloat(_amount.toFixed(BteGlobal.ROUND_TOTAL));var amountText=Math.abs(amountF).ReadNumber(typeCurrency).replace(/\s\s+/g," ");if($("#INV_TYPE").val()=="6"){if(amountF<0){$("#AmountInWords").val("Giảm "+amountText.toLowerCase())}else{$("#AmountInWords").val("Tăng "+amountText.toLowerCase())}}else if($("#INV_TYPE").val()=="3"||amountF<0&&location.pathname.toLowerCase()=="/adjust/createadjustinvwithtoken"){$("#AmountInWords").val("Giảm "+amountText.toLowerCase())}else{$("#AmountInWords").val(parseFloat(amountF).ReadNumber(typeCurrency).replace(/\s\s+/g," "))}if(VATkhac!=-3){$("#VATAmount").val(_vatamount.format(0,3,typeCurrency))}$("#Amount").val(amountF.format(0,3,typeCurrency)).attr("value",amountF.format(0,3,typeCurrency));setAmountInWords_over(_vatrate)};this.setAmountInWords_over=function(vatRate){};this.loadCurrencyUnit=function(){var _kieuHd=$("#CurrencyUnit").val();if(_kieuHd=="VND"){document.getElementById("divTyGia").style.display="none";document.getElementById("divTongTien").style.display="none"}else if(_kieuHd!=""){document.getElementById("divTyGia").style.display="block";document.getElementById("divTongTien").style.display="block"}};this.changeCurrencyUnit=function(){$("#CurrencyUnit").change(function(){if($(this).val()=="VND"){$("#ExchangeRate").val("");$("#ConvertedAmount").val("");document.getElementById("divTyGia").style.display="none";document.getElementById("divTongTien").style.display="none";BteGlobal.ROUND_TOTAL=0}else if($(this).val()!=""){BteGlobal.ROUND_TOTAL=2;document.getElementById("divTyGia").style.display="block";document.getElementById("divTongTien").style.display="block"}typeCurrency=$(this).val();formatTagInputNumber($(this).val());$("#VATRateItem").trigger("change");$("#moneySymbol")[0].innerHTML=$(this).val()})};this.changeExchangeRate=function(){$("#ExchangeRate").focusout(function(){convertAmount()})};this.convertAmount=function(){var _tyGia;var strTyGia=$("#ExchangeRate").val().FormatNumUK();if(strTyGia){_tyGia=parseFloat(strTyGia)}else{_tyGia=0;$("#ExchangeRate").val(0)}if($("#Amount").val()!==null&&_tyGia>=0&&$("#CurrencyUnit").val()!="VND"){var _amount=parseFloat($("#Amount").val().FormatNumUK());var _TongSoTien=parseFloat((_amount*_tyGia).toFixed());if($("#INV_TYPE").val()=="3"){if(_TongSoTien>0){$("#ConvertedAmount").val("-"+_TongSoTien.format(0,3,"USD"))}else{$("#ConvertedAmount").val(_TongSoTien.format(0,3,"USD"))}}else $("#ConvertedAmount").val(_TongSoTien.format(0,3,"USD"))}};this.formatTagInputNumber=function(typeCurrency){$("#ConvertedAmount").InitialMoneyUSD();$("table.products tbody input._number").unbind("focusout");$("#ExchangeRate").formatOnlyNumber();$("table.products tbody input._number").each(function(i,item){fnInitialFormatNumber(this);if(!(BteGlobal.IS_EDIT||BteGlobal.IS_SIGN_REPLACE_TOKEN||BteGlobal.IS_SIGN_ADJSUT_TOKEN)){$(this).parents("tr:first").find("input.amount").trigger("change")}}).ForceNumericOnly().focus(function(){var _val=$(this).val();$(this).val(_val.replaceAll(".",""))}).focusout(function(){fnFocusOut(this);if(!(BteGlobal.IS_EDIT||BteGlobal.IS_SIGN_REPLACE_TOKEN||BteGlobal.IS_SIGN_ADJSUT_TOKEN)){$(this).parents("tr:first").find("input.amount").trigger("change")}});$("table.list-bin-bottom tbody input._number").unbind("focusout");$(".groupTotal").each(function(i,item){fnInitialFormatNumber(this)}).ForceNumericOnly().focus(function(){var _val=$(this).val();$(this).val(_val.replaceAll(".",""))}).focusout(function(){fnFocusOut(this)});formatTagInputNumber_over(typeCurrency)};this.formatTagInputNumber_over=function(typeCurrency){};this.fnInitialFormatNumber=function(element){var _val=$(element).val();if(_val){_val=_val.replaceAll(".","").replaceAll(",",".");if($(element)[0].className.indexOf("quantity")>-1){if(_val.indexOf(".")>-1){$(element).val(parseFloat(_val).format(2,3,typeCurrency,true))}else{$(element).val(parseFloat(_val).format(0,3))}}else{if(typeCurrency=="VND"){$(element).val(parseFloat(_val).format(0,3))}else{if(typeCurrency=="USD"){$(element).val(parseFloat(_val).format(2,3,typeCurrency))}}}}};jQuery.event.copy=function(from,to){from=from.jquery?from:jQuery(from);to=to.jquery?to:jQuery(to);var events=from[0].events||jQuery.data(from[0],"events")||jQuery._data(from[0],"events");if(!from.length||!to.length||!events)return;return to.each(function(){for(var type in events){for(var handler in events[type])jQuery.event.add(this,type,events[type][handler],events[type][handler].data)}})};this.readAfterAmountChanged=function(){var _totalamount=parseFloat($("#Total").val().FormatNumUK());var _vatamount=0;if($("#VATAmount").val()){_vatamount=parseFloat($("#VATAmount").val().FormatNumUK())}var _amount=Math.abs(_totalamount)+Math.abs(_vatamount);if($("#INV_TYPE").val()=="3"){$("#AmountInWords").val("Giảm "+Math.abs(parseFloat(_amount)).ReadNumber(typeCurrency).replace(/\s\s+/g," ").toLowerCase());_amount=_amount*-1}else{$("#AmountInWords").val(parseFloat($("#Amount").val().FormatNumUK()).ReadNumber(typeCurrency).replace(/\s\s+/g," "))}$("#Amount").val(_amount.format(2,3,typeCurrency)).trigger("change");readAfterAmountChanged_over()};this.readAfterAmountChanged_over=function(){};function ChangeVATRateF(){$("#VATRateItem").trigger("change")}function changePosExtraInput(){}function nhapSTT(){$("table.products tr td.delr").each(function(e,a){var TR=$(this).parents("tr");var td1=TR.find("td").eq(1);var Re=TR.find("td.col-Remark");Re.removeClass("hide");Re.addClass("text-center");Re.find("input").addClass("text-center");Re.find("input").removeClass("textr");td1.after(Re);TR.find("td.col-Remark").eq(1).remove()});$("table.products tr td.delr").each(function(e,a){var TR=$(this).parents("tr");TR.find("td").eq(1).hide();var Re=TR.find("td.col-Remark");TR.find("td.col-Remark").eq(1).remove()});$("table.products tr th").eq(1).hide();var remarkTD=$("table.products tr th.RemarkTH");remarkTD.removeClass("hide");remarkTD.text("STT");remarkTD.css({width:"30px"});remarkTD.addClass("text-center");$("table.products tr th").eq(1).after(remarkTD);BteGlobal.NEW_ROW_STR=getProductRowStr()}function configTableProduct(ARR){if(!ARR||ARR.length==0||!ARR[0].tag)return;for(var i=0;i<ARR.length;i++){var el=ARR[i];var Position=parseInt(el.pos);var classTag="."+el.tag;var HEAD=$("table.products th."+el.tag+"TH");if($("table.products "+classTag.toLowerCase()).length==0){console.log(" Tag: "+classTag+" not found")}HEAD.removeClass("hide");if(el.header){HEAD.html(el.header)}if(el.width&&el.width!=""){HEAD.css("width",el.width)}if(!isNaN(Position)&&Position>0){$("table.products th").eq(Position).before($("table.products th."+el.tag+"TH"));$("table.products tr").each(function(){var el_td=$(this).find(classTag.toLowerCase()).parents("td");el_td.removeClass("hide");$(this).find("td").eq(Position).before(el_td.eq(0))})}if(el.classInput){$("table.products tr").each(function(){var tagEL=$(this).find(classTag.toLowerCase());tagEL.attr("class",el.tag.toLowerCase());tagEL.addClass(el.classInput)})}if(el.hide=="1"){$("table.products th."+el.tag+"TH").addClass("hide");$("table.products tr").each(function(){var tagEL=$(this).find(classTag.toLowerCase());tagEL.parents("td").eq(0).addClass("hide");tagEL.addClass("hide")})}}BteGlobal.NEW_ROW_STR=getProductRowStr()}function resetValNumProduct(){$("#bodyTblProduct input._number[value]").each(function(i,e){var r=$(e).attr("value");var clas1=$(e).attr("class");if(r&&clas1.indexOf("amount")==-1){$(e).val(r.trim().replace(".",","))}})}function setAmDonGia(){if($("#INV_TYPE").val()=="3"){$("table.products tbody input.price._number").each(function(){var v1=$(this).val()||"0";if(v1.FormatNumUK()>0){if(v1!=""&&v1!="0"){$(this).val(parseFloat("-"+Math.abs(v1.FormatNumUK())).format(2,3,typeCurrency,true))}}})}}function CheckDiscountEmpty(){var DiscountNonTaxv=($("#DiscountNonTax").val()||"0").FormatNumUK();var DiscountOtherv=($("#DiscountOther").val()||"0").FormatNumUK();if(DiscountNonTaxv!=0||DiscountOtherv!=0){$("#DiscountNonTax").parents(".line").eq(0).show().removeClass("hidden");$("#DiscountOther").parents(".line").eq(0).show().removeClass("hidden");return false}return true}$("#hideDiscountOpt").change(function(){if(!CheckDiscountEmpty()&&$("#hideDiscountOpt").prop("checked")){alert("Xóa số tiền ô giảm trừ để ẩn");$("#hideDiscountOpt").prop("checked",false);return false}if($("#hideDiscountOpt").prop("checked")){$("#DiscountNonTax").parents(".line").eq(0).hide();$("#DiscountOther").parents(".line").eq(0).hide()}else{$("#DiscountNonTax").parents(".line").eq(0).show().removeClass("hidden");$("#DiscountOther").parents(".line").eq(0).show().removeClass("hidden")}localStorage.setItem(BteGlobal.PATTERN_NUM+"hideDiscountOpt",$("#hideDiscountOpt").prop("checked").toString())});function ViewDetailInv(){var _valid=$("form:first").valid();if(!_valid){return false}submit();$.ajax({type:"POST",url:"/Share/ajxPreviewCreateInv",data:$("form:first").serialize(),success:function(data){$("#container").html(data+"<div class='pagination'><span id='prev' class='prevnext'><</span><span id='next' class='prevnext'></span></div>");$(function(){$("#4plugin").remove();$("#plugin0").remove();$("#ViewInvoice").bPopup({easing:"easeOutBack",speed:450,transition:"slideDown"});if($(".pagination span").length==2)$("#quantitypages").ProductNumberPagination({number:1})});$("#ArisingDate").attr("name","ArisingDate");$("#defaultArisingDate").attr("name","defaultArisingDate")}})}function cauHinhSoLe(){var configForPatten="CF_"+$(".mst").text().replace(/ /g,"").trim()+$("#Pattern").val().replace(/\//g,"");var cf={};if(localStorage[configForPatten]){cf=JSON.parse(localStorage[configForPatten]);if(cf["NumberBehindComma2"]&&cf["NumberBehindComma2"]!=""){$("#NumberBehindComma").val(cf["NumberBehindComma2"]);$("#NumberBehindComma").attr("value",cf["NumberBehindComma2"])}}$("#totalRound").change(function(){$("table.products .quantity").trigger("focusin").trigger("focusout").trigger(`change`);cf["totalRound"]=$("#totalRound").val();localStorage[configForPatten]=JSON.stringify(cf)});$("#NumberBehindComma2").change(function(){$("#NumberBehindComma").val($("#NumberBehindComma2").val()).trigger(`change`);cf["NumberBehindComma2"]=$("#NumberBehindComma2").val();localStorage[configForPatten]=JSON.stringify(cf);formatTagInputNumber(typeCurrency)});$("#TotalFomular").change(function(){cf["TotalFomular"]=$("#TotalFomular").val();localStorage[configForPatten]=JSON.stringify(cf)});if(cf["NumberBehindComma2"]){$("#NumberBehindComma2").val(cf["NumberBehindComma2"]).trigger(`change`);$("#NumberBehindComma").val(cf["NumberBehindComma2"])}if(cf["totalRound"]){$("#totalRound").val(cf["totalRound"])}else{$("#totalRound").val($("#NumberBehindComma").val())}if(cf["TotalFomular"]){$("#TotalFomular").val(cf["TotalFomular"]).trigger(`change`)}if(location.pathname=="/AdJust/CreateReplaceInvWithToken"||location.pathname.indexOf("/EInvoice/Edit/")==0){return}formatTagInputNumber(typeCurrency)}